!function(){"use strict";const e="EasyTorrent",t="1.1.0 Beta",n='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/></svg>',r="https://xozswgtbcjorxzabawmk.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvenN3Z3RiY2pvcnh6YWJhd21rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyODAzODksImV4cCI6MjA4Njg1NjM4OX0.ajYvu0KecRKZGLge_682oU5MD-WiQSM2jNZwuGHw2Uo",o="https://cevamnelampaplagin.github.io/plugins/";let a=null;const i={version:"2.1",generated:"2026-02-17T13:43:12.099Z",device:{type:"tv_fhd",supported_hdr:[],supported_audio:["stereo"]},network:{speed:"very_fast",stability:"stable"},parameter_priority:["audio_track","resolution","availability","bitrate","hdr","audio_quality"],audio_track_priority:[1,6,11,22,44],preferences:{min_seeds:3,recommendation_count:3,languages:["rus"]},scoring_rules:{schema:"2.1",base_score:100,weights:{audio_track:100,resolution:85,availability:70,bitrate:55,hdr:40,audio_quality:25},resolution:{2160:34,1440:42.5,1080:85,720:8.5,480:-34},hdr:{dolby_vision:-8,hdr10plus:-6,hdr10:-6,sdr:0},bitrate_bonus:{thresholds:[{min:0,max:5,bonus:2.75},{min:5,max:15,bonus:11},{min:15,max:30,bonus:8.25},{min:30,max:999,bonus:0}],missing_penalty:-8.25},availability:{min_seeds:3,below_min_penalty:-14,log10_multiplier:8.4},audio_track:{curve:"linear",max_points:100},audio_quality:{points:{dolby_atmos:0,surround_71:0,surround_51:0,stereo:0,unknown:0}},special_rules:[]}};let l=i;const u="easytorrent_modal_update_v110_shown",d="easytorrent_modal_welcome_shown",c="easytorrent_config_json";let p=!1,m=!1,g=null;const f="EasyTorrent",y="@darkestclouds",_=["easytorrent"],b={easytorrent_title:{ru:"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —Ç–æ—Ä—Ä–µ–Ω—Ç—ñ–≤",en:"Torrent Recommendations"},easytorrent_desc:{ru:"–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î–º—ñ —Ç–æ—Ä—Ä–µ–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤—ñ —è–∫–æ—Å—Ç—ñ, HDR —ñ –æ–∑–≤—É—á–∫–∏",en:"Show recommended torrents based on quality, HDR and audio"},recommended_section_title:{ru:"–†–µ–∫–æ–º–µ–Ω–¥—É—î–º—ñ",en:"Recommended"},show_scores:{ru:"–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –æ—Ü—ñ–Ω–∫–∏",en:"Show scores"},show_scores_desc:{ru:"–í—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –æ—Ü—ñ–Ω–∫—É —è–∫–æ—Å—Ç—ñ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞",en:"Display torrent quality score"},ideal_badge:{ru:"–Ü–¥–µ–∞–ª—å–Ω–æ",en:"Ideal"},recommended_badge:{ru:"–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—Å—è",en:"Recommended"},config_json:{ru:"–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (JSON)",en:"Configuration (JSON)"},config_json_desc:{ru:"–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å , —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",en:"Click to view or change settings"},config_view:{ru:"–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏",en:"View parameters"},config_edit:{ru:"–í—Å—Ç–∞–≤–∏—Ç–∏ JSON",en:"Paste JSON"},config_reset:{ru:"–°–∫–∏–Ω—É—Ç–∏ –¥–æ –∑–∞–≤–æ–¥—Å—å–∫–∏—Ö",en:"Reset to defaults"},config_error:{ru:"–ü–æ–º–∏–ª–∫–∞: –ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç JSON",en:"Error: Invalid JSON format"}};function h(e){const t=Lampa.Storage.get("language","ru");return b[e]&&b[e][t]||b[e].ru||e}function v(e){return JSON.parse(JSON.stringify(e))}function w(){l=v(i);try{Lampa.Storage.set(c,JSON.stringify(l))}catch(e){}}function L(){try{if(document&&document.querySelector&&document.querySelector(".extensions"))return!0}catch(e){}try{const e=Lampa.Controller&&"function"==typeof Lampa.Controller.enabled?Lampa.Controller.enabled():null;if(e&&"extensions"===e.name)return!0}catch(e){}return!1}function S(){g||(g=setInterval((()=>{try{if(!function(){const e=p&&!Lampa.Storage.get(u,!1),t=m&&!Lampa.Storage.get(d,!1);return e||t}())return clearInterval(g),void(g=null);if(!function(){try{return!!Lampa.Storage.get("easytorrent_enabled",!0)}catch(e){return!0}}())return;if(L())return;!function(){if(L())return!1;const e=Lampa.Controller&&"function"==typeof Lampa.Controller.enabled&&Lampa.Controller.enabled()?Lampa.Controller.enabled().name:"content";if(!(window.Lampa&&Lampa.Modal&&"function"==typeof Lampa.Modal.open&&window.Lampa&&Lampa.Controller&&"function"==typeof Lampa.Controller.toggle&&"function"==typeof $))return!1;if(p&&!Lampa.Storage.get(u,!1)){const n=$(`\n                <div class="about">\n                    <div class="about__text">\n                        <div><strong>–©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—å:</strong></div>\n                        <ol>\n                            <li>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏ —Ä–∞—Å—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ </li>\n                            <li>–î–æ–¥–∞–Ω—ñ –±–∞–ª–∏ –∑–∞ —è–∫—ñ—Å—Ç—å –∑–≤—É–∫—É (Atmos / 7.1 / 5.1)</li>\n                            <li>–ü–æ–ª—ñ–ø—à–µ–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –±—ñ—Ç—Ä–µ–π—Ç—É —Ç–∞ —Ä–æ–±–æ—Ç—É –∑ —Å–µ—Ä—ñ–∞–ª–∞–º–∏.</li>\n                        </ol>\n                        <p style="padding: 0.75em 0.9em; border-radius: 0.6em; background: rgba(255,193,7,0.14); border: 1px solid rgba(255,193,7,0.35);">\n                            <strong style="color: #ffc107;">‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û:</strong>\n                            –ö–æ–Ω—Ñ—ñ–≥ —Å–∫–∏–Ω—É—Ç–∏–π –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —á–µ—Ä–µ–∑ –Ω–µ—Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å. –ü–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ.\n                        </p>\n                        <p><strong>–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</strong></p>\n                        <ul>\n                            <li>–ü—Ä–∏—Å—Ç—Ä—ñ–π: <strong>FHD (1080p)</strong></li>\n                            <li>HDR: <strong>–≤–∏–∫–ª—é—á–µ–Ω–æ (SDR)</strong></li>\n                            <li>–ó–≤—É–∫: <strong>—Å—Ç–µ—Ä–µ–æ</strong> (–±–µ–∑ 5.1/7.1/Atmos)</li>\n                            <li>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏: <strong>–û–∑–≤—É—á–∫–∞ ‚Üí –†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å ‚Üí –°—ñ–¥–∏ ‚Üí –ë—ñ—Ç—Ä–µ–π—Ç</strong></li>\n                            <li>–ú—ñ–Ω. —Å—ñ–¥—ñ–≤: <strong>${i.preferences.min_seeds}</strong>, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π: <strong>${i.preferences.recommendation_count}</strong></li>\n                        </ul>\n                        <p>\n                            –î–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏:\n                            <br><strong>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí EasyTorrent ‚Üí ‚Äú–†–æ–∑—Å—Ç–∞–≤–∏—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏‚Äù</strong>\n                        </p>\n                    </div>\n                </div>\n            `);try{return Lampa.Modal.open({title:`–û–Ω–æ–≤–ª–µ–Ω–Ω—è EasyTorrent v${t}`,size:"large",html:n,mask:!0,buttons_position:"outside",buttons:[{name:"–í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",onSelect:()=>C(e)},{name:"–ó–∞–∫—Ä–∏—Ç–∏",onSelect:()=>{Lampa.Modal.close(),Lampa.Controller.toggle(e)}}],onBack:()=>{Lampa.Modal.close(),Lampa.Controller.toggle(e)}}),Lampa.Storage.set(u,!0),!0}catch(e){return console.error("[EasyTorrent] Modal.open failed:",e),!1}}if(m&&!Lampa.Storage.get(d,!1)){const n=$(`\n                <div class="about">\n                    <div class="about__text">\n                        <div>\n                            –î–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏ (–æ–∑–≤—É—á–∫–∞/—è–∫—ñ—Å—Ç—å/—Å—ñ–¥–∏ —ñ —Ç.–¥.).\n                        </div>\n                        <p>\n                            –ù–∞—Ä–∞–∑—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –∑–∞ —É–º–æ–≤—á–∞–Ω–Ω—è–º:\n                        </p>\n                        <ul>\n                            <li>–ü—Ä–∏—Å—Ç—Ä—ñ–π: <strong>FHD (1080p)</strong></li>\n                            <li>HDR: <strong>–≤–∏–∫–ª—é—á–µ–Ω–æ (SDR)</strong></li>\n                            <li>–ó–≤—É–∫: <strong>—Å—Ç–µ—Ä–µ–æ</strong> (–±–µ–∑ 5.1/7.1/Atmos)</li>\n                            <li>–ü—Ä–∏–æ—Ä—ñ—Ç–µ—Ç–∏: <strong>–û–∑–≤—É—á–∫–∞ ‚Üí –†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å ‚Üí –°—ñ–¥–∏ ‚Üí –ë—ñ—Ç—Ä–µ–π—Ç</strong></li>\n                            <li>–ú—ñ–Ω. —Å—ñ–¥—ñ–≤: <strong>${i.preferences.min_seeds}</strong>, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π: <strong>${i.preferences.recommendation_count}</strong></li>\n                        </ul>\n                        <p>\n                            –ü–µ—Ä–µ–π–¥—ñ—Ç—å:\n                            <br><strong>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí EasyTorrent ‚Üí ‚Äú–†–æ–∑—Å—Ç–∞–≤–∏—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏‚Äù</strong>\n                            <br>—ñ –ø—Ä–æ–π–¥—ñ—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ —Å–≤–æ—î–º—É —Ç–µ–ª–µ—Ñ–æ–Ω—ñ —á–µ—Ä–µ–∑ QR.\n                        </p>\n                    </div>\n                </div>\n            `);try{return Lampa.Modal.open({title:`EasyTorrent —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (v${t})`,size:"large",html:n,mask:!0,buttons_position:"outside",buttons:[{name:"–í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",onSelect:()=>C(e)},{name:"–ó–∞–∫—Ä–∏—Ç–∏",onSelect:()=>{Lampa.Modal.close(),Lampa.Controller.toggle(e)}}],onBack:()=>{Lampa.Modal.close(),Lampa.Controller.toggle(e)}}),Lampa.Storage.set(d,!0),!0}catch(e){return console.error("[EasyTorrent] Modal.open failed:",e),!1}}}()}catch(e){}}),1500))}function k(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function x(e){return"string"==typeof e&&e.length>0}function M(e){return function(e){return"number"==typeof e&&Number.isFinite(e)}(e)}function N(e){return{ok:!1,error:e}}function O(e){if(!k(e))return N("–ö–æ–Ω—Ñ—ñ–≥ –º–∞—î –±—É—Ç–∏ –æ–±—î–∫—Ç–æ–º JSON");const t=String(e.version||"");if("2.0"===t||t.startsWith("2.0"))return N("–ö–æ–Ω—Ñ—ñ–≥–∏ –≤–µ—Ä—Å—ñ—ó 2.0 –±—ñ–ª—å—à–µ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—Å—è. –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ –Ω–æ–≤–∏–π –∫–æ–Ω—Ñ—ñ–≥ (2.1) —É –≤—ñ–∑–∞—Ä–¥—ñ.");if(!t.startsWith("2.1"))return N(`–ù–µ–ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∞ –≤–µ—Ä—Å—ñ—è –∫–æ–Ω—Ñ—ñ–≥–∞: ${t||"–Ω–µ —É–∫–∞–∑–∞–Ω–∞"}. –û—á—ñ–∫—É—î—Ç—å—Å—è 2.1.`);if(!k(e.device))return N("–ü–æ–ª–µ device –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É");if(!x(e.device.type))return N("–ü–æ–ª–µ device.type –≤—ñ–¥—Å—É—Ç–Ω—î —á–∏ –Ω–µ–≤—ñ—Ä–Ω–æ–≥–æ —Ç–∏–ø—É");if(!Array.isArray(e.device.supported_hdr))return N("–ü–æ–ª–µ device.supported_hdr –º–∞—î –±—É—Ç–∏ –º–∞—Å–∏–≤–æ–º");if(!Array.isArray(e.device.supported_audio))return N("–ü–æ–ª–µ device.supported_audio –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º");if(!k(e.network))return N("–ü–æ–ª–µ network –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É");if(!x(e.network.speed))return N("–ü–æ–ª–µ network.speed –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É");if(!x(e.network.stability))return N("–ü–æ–ª–µ network.stability –≤—ñ–¥—Å—É—Ç–Ω—î —á–∏ –Ω–µ–≤—ñ—Ä–Ω–æ–≥–æ —Ç–∏–ø—É");if(!Array.isArray(e.parameter_priority)||0===e.parameter_priority.length)return N("–ü–æ–ª–µ parameter_priority –º–∞—î –±—É—Ç–∏ –Ω–µ–ø—É—Å—Ç–∏–º –º–∞—Å–∏–≤–æ–º");if(!Array.isArray(e.audio_track_priority)||0===e.audio_track_priority.length)return N("–ü–æ–ª–µ audio_track_priority –º–∞—î –±—É—Ç–∏ –Ω–µ–ø—É—Å—Ç–∏–º –º–∞—Å–∏–≤–æ–º");for(const t of e.audio_track_priority){if("number"!=typeof t||!Number.isFinite(t))return N("–ü–æ–ª–µ audio_track_priority –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ –ª–∏—à–µ —á–∏—Å–ª–æ–≤—ñ id –æ–∑–≤—É—á–æ–∫ (–±–µ–∑ —Å—Ç—Ä–æ–∫–æ–≤–∏—Ö –Ω–∞–∑–≤)");if(!Q||Q.has&&!Q.has(t))return N("–ü–æ–ª–µ audio_track_priority –º—ñ—Å—Ç–∏—Ç—å –Ω–µ–≤—ñ–¥–æ–º–∏–π id –æ–∑–≤—É—á–∫–∏")}if(!k(e.preferences))return N("–ü–æ–ª–µ preferences –≤—ñ–¥—Å—É—Ç–Ω—è –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É");if(!M(e.preferences.min_seeds))return N("–ü–æ–ª–µ preferences.min_seeds –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º");if(!M(e.preferences.recommendation_count))return N("–ü–æ–ª–µ preferences.recommendation_count –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º");if(!Array.isArray(e.preferences.languages)||0===e.preferences.languages.length)return N('–ü–æ–ª–µ preferences.languages –º–∞—î –±—É—Ç–∏ –Ω–µ–ø—É—Å—Ç–∏–º –º–∞—Å–∏–≤–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ ["rus","eng"])');for(const t of e.preferences.languages)if("string"!=typeof t||!t.trim())return N("–ü–æ–ª–µ preferences.languages –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ –ª–∏—à–µ —Ä—è–¥–∫–∏");if(!k(e.scoring_rules))return N("–ü–æ–ª–µ scoring_rules –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–≤—ñ—Ä–Ω–æ–≥–æ —Ç–∏–ø—É");const n=e.scoring_rules;if("2.1"!==String(n.schema||""))return N('–ü–æ–ª–µ scoring_rules.schema –º–∞—î –±—É—Ç–∏ "2.1"');if(!M(n.base_score))return N("–ü–æ–ª–µ scoring_rules.base_score –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º");if(!k(n.resolution))return N("–ü–æ–ª–µ scoring_rules.resolution –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É");if(!k(n.hdr))return N("–ü–æ–ª–µ scoring_rules.hdr –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É");if(!k(n.bitrate_bonus))return N("–ü–æ–ª–µ scoring_rules.bitrate_bonus –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–≤—ñ—Ä–Ω–æ–≥–æ —Ç–∏–ø—É");if(!Array.isArray(n.bitrate_bonus.thresholds))return N("–ü–æ–ª–µ scoring_rules.bitrate_bonus.thresholds –º–∞—î –±—É—Ç–∏ –º–∞—Å–∏–≤–æ–º");if(!M(n.bitrate_bonus.missing_penalty))return N("–ü–æ–ª–µ scoring_rules.bitrate_bonus.missing_penalty –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º");for(const e of n.bitrate_bonus.thresholds){if(!k(e))return N("–ï–ª–µ–º–µ–Ω—Ç–∏ scoring_rules.bitrate_bonus.thresholds –º–∞—é—Ç—å –±—É—Ç–∏ –æ–±'—î–∫—Ç–∞–º–∏");if(!M(e.min)||!M(e.max)||!M(e.bonus))return N("thresholds: –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ —á–∏—Å–ª–æ–≤—ñ –ø–æ–ª—è min/max/bonus")}return k(n.availability)?M(n.availability.min_seeds)?M(n.availability.below_min_penalty)?M(n.availability.log10_multiplier)?k(n.audio_track)?x(n.audio_track.curve)?M(n.audio_track.max_points)?k(n.audio_quality)?k(n.audio_quality.points)?void 0===n.special_rules||Array.isArray(n.special_rules)?{ok:!0}:N("–ü–æ–ª–µ scoring_rules.special_rules –º–∞—î –±—É—Ç–∏ –º–∞—Å–∏–≤–æ–º (–∞–±–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ–º)"):N("–ü–æ–ª–µ scoring_rules.audio_quality.points –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É"):N("–ü–æ–ª–µ scoring_rules.audio_quality –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É"):N("–ü–æ–ª–µ scoring_rules.audio_track.max_points –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º"):N("–ü–æ–ª–µ scoring_rules.audio_track.curve –º–∞—î –±—É—Ç–∏ —Å—Ç—Ä–æ–∫–æ—é"):N("–ü–æ–ª–µ scoring_rules.audio_track –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É"):N("–ü–æ–ª–µ scoring_rules.availability.log10_multiplier –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º"):N("–ü–æ–ª–µ scoring_rules.availability.below_min_penalty –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º"):N("–ü–æ–ª–µ scoring_rules.availability.min_seeds –º–∞—î –±—É—Ç–∏ —á–∏—Å–ª–æ–º"):N("–ü–æ–ª–µ scoring_rules.availability –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø—É")}function C(e){try{Lampa.Modal.close()}catch(e){}Lampa.Controller.toggle("settings"),setTimeout((()=>{Lampa.Settings&&"function"==typeof Lampa.Settings.create&&Lampa.Settings.create("easytorrent",{onBack:()=>{Lampa.Controller.toggle("settings")}})}),50)}function A(e){const t="string"==typeof e?e:JSON.stringify(e);try{const e=JSON.parse(t),n=O(e);if(!n.ok)return void(Lampa.Noty&&Lampa.Noty.show?Lampa.Noty.show(n.error):alert(n.error));Lampa.Storage.set(c,t),l=e}catch(e){l=v(i)}}function R(){const e=l,t=[{title:"–í–µ—Ä—Å—ñ—è –∫–æ–Ω—Ñ—ñ–≥–∞",subtitle:e.version,noselect:!0},{title:"–¢–∏–ø –ø—Ä–∏—Å—Ç—Ä–æ—é",subtitle:e.device.type.toUpperCase(),noselect:!0},{title:"–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ HDR",subtitle:e.device.supported_hdr.join(", ")||"–Ω—ñ",noselect:!0},{title:"–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∑–≤—É–∫–∞",subtitle:e.device.supported_audio.join(", ")||"—Å—Ç–µ—Ä–µ–æ",noselect:!0},{title:"–ú–æ–≤–∏ –∞—É–¥–∏–æ",subtitle:e.preferences&&Array.isArray(e.preferences.languages)?e.preferences.languages.join(", "):"–Ω–µ –∑–∞–¥–∞–Ω–æ",noselect:!0},{title:"–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤",subtitle:e.parameter_priority.join(" > "),noselect:!0},{title:"–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –æ–∑–≤—É—á–æ–∫",subtitle:`${e.audio_track_priority.length} —à—Ç. ‚Ä¢ –ù–∞–∂–º—ñ—Ç—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É`,action:"show_voices"},{title:"–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ —Å—ñ–¥—ñ–≤",subtitle:e.preferences.min_seeds,noselect:!0},{title:"–ß–∏—Å–ª–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π",subtitle:e.preferences.recommendation_count,noselect:!0}];Lampa.Select.show({title:"–ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è",items:t,onSelect:e=>{"show_voices"===e.action&&function(){const e=l,t=e.audio_track_priority.map(((e,t)=>{const n=ee(e);return{title:`${t+1}. ${"number"==typeof n&&Q.get(n)?Q.get(n).name:String(e)}`,noselect:!0}})),n=t.length?t:[{title:"–ü—É—Å—Ç–æ",noselect:!0}];Lampa.Select.show({title:"–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –æ–∑–≤—É—á–æ–∫",items:n,onBack:()=>{R()}})}()},onBack:()=>{Lampa.Controller.toggle("settings")}})}function E(e){const t=(e.Title||e.title||"").toLowerCase();if(e.ffprobe&&Array.isArray(e.ffprobe)){const t=e.ffprobe.find((e=>"video"===e.codec_type));if(t&&t.height)return e._et_resolution_debug={source:"ffprobe",width:t.width||null,height:t.height||null},t.height>=2160||t.width&&t.width>=3800?2160:t.height>=1440||t.width&&t.width>=2500?1440:t.height>=1080||t.width&&t.width>=1900?1080:t.height>=720||t.width&&t.width>=1260?720:480}return e._et_resolution_debug={source:"title"},/\b2160p\b/.test(t)||/\b4k\b/.test(t)?2160:/\b1440p\b/.test(t)||/\b2k\b/.test(t)?1440:/\b1080p\b/.test(t)?1080:/\b720p\b/.test(t)?720:null}function V(e,t=!1){if(t){const t=e&&e.info&&(e.info.videotype||e.info.video_type||e.info.hdr);if("string"==typeof t&&t){const e=t.toLowerCase();if("sdr"===e)return"sdr";if("hdr10"===e)return"hdr10";if("hdr10plus"===e||"hdr10+"===e)return"hdr10plus";if("dolby_vision"===e||"dovi"===e||"dv"===e)return"dolby_vision";if("hdr"===e)return"hdr10"}}const n=(e.Title||e.title||"").toLowerCase(),r=[],s=e=>{try{return new RegExp(`(?:^|[^\\p{L}\\p{N}])(?:${e})(?=$|[^\\p{L}\\p{N}])`,"iu").test(n)}catch(t){return new RegExp(`(?:^|[^a-z0-9_])(?:${e})(?=$|[^a-z0-9_])`,"i").test(n)}};if(e.ffprobe&&Array.isArray(e.ffprobe)){const t=e.ffprobe.find((e=>"video"===e.codec_type));if(t&&t.side_data_list){t.side_data_list.some((e=>"DOVI configuration record"===e.side_data_type||"Dolby Vision RPU"===e.side_data_type))&&r.push("dolby_vision")}}if((s("hdr10\\+")||s("hdr10plus")||s("hdr10\\s*plus"))&&(r.includes("hdr10plus")||r.push("hdr10plus")),(s("hdr-?10")||s("hdr10"))&&(r.includes("hdr10")||r.push("hdr10")),(n.includes("dolby vision")||n.includes("dovi")||/\sp8\s/.test(n)||/\(dv\)/.test(n)||/\[dv\]/.test(n)||/\sdv\s/.test(n)||/,\s*dv\s/.test(n))&&(r.includes("dolby_vision")||r.push("dolby_vision")),!s("hdr")||r.includes("hdr10plus")||r.includes("hdr10")||r.push("hdr10"),s("sdr")&&(r.includes("sdr")||r.push("sdr")),0===r.length)return e._et_hdr_debug={source:"title",foundTypes:[],chosen:"sdr"},"sdr";const o=l.scoring_rules.hdr;let a=r[0],i=o[a]||0;return r.forEach((e=>{const t=o[e]||0;t>i&&(i=t,a=e)})),e._et_hdr_debug={source:"title",foundTypes:r.slice(0),chosen:a},a}function I(e){const t=(e.Title||e.title||"").toLowerCase();if(/\batmos\b/.test(t)||t.includes("dolby atmos"))return"dolby_atmos";if(/\b7[ .]?1\b/.test(t)||t.includes("7.1ch")||t.includes("7 1"))return"surround_71";if(/\b5[ .]?1\b/.test(t)||t.includes("5.1ch")||t.includes("5 1"))return"surround_51";if(e.ffprobe&&Array.isArray(e.ffprobe)){const t=e.ffprobe.filter((e=>"audio"===e.codec_type));let n=null;if(t.forEach((e=>{const t="number"==typeof e.channels?e.channels:null,r=(e.channel_layout||"").toLowerCase();let s=0;(e.tags?.title||e.tags?.handler_name||"").toLowerCase().includes("atmos")||r.includes("atmos")?s=4:r.includes("7.1")||8===t?s=3:r.includes("5.1")||6===t?s=2:(r.includes("stereo")||2===t)&&(s=1),(!n||s>n.rank)&&(n={rank:s})})),n){if(4===n.rank)return"dolby_atmos";if(3===n.rank)return"surround_71";if(2===n.rank)return"surround_51";if(1===n.rank)return"stereo"}}return"stereo"}function T(e){const t=parseInt(e,10);return Number.isFinite(t)?t:null}function q(e,t){return null==e?null:null==t||t===e?{start:e,end:e}:{start:Math.min(e,t),end:Math.max(e,t)}}function P(e){return Number.isInteger(e)&&e>=1&&e<=60}function D(e){return Number.isInteger(e)&&e>=0&&e<=5e3}function j(e,t){return!(!Number.isInteger(e)||!Number.isInteger(t))&&(!(e<1900||e>2100)&&(!(t<1900||t>2100)&&(!(t<e)&&t-e<=60)))}function z(e){const t=e.toLowerCase(),n=[/(?:^|[^\p{L}\p{N}])(—Ñ–∏–ª—å–º|film|movie|movies)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(—Å–ø–µ—Ü–≤—ã–ø—É—Å–∫|special|specials|sp|ova|ona|bonus|extra|—ç–∫—Å—Ç—Ä–∞|—Å–ø—ç—à–ª|—Å–ø–µ—à–ª|—Å–ø—ç—à–∞–ª|–æ–≤–∞|–æ–Ω–∞|—Å–ø—ç—à–µ–ª)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(—Ç—Ä–µ–π–ª–µ—Ä|trailer|teaser|—Ç–∏–∑–µ—Ä)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(—Å–∞—É–Ω–¥—Ç—Ä–µ–∫|ost|soundtrack)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(–∫–ª–∏–ø|clip|pv)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(–∏–Ω—Ç–µ—Ä–≤—å—é|interview)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(—Ä–µ–ø–æ—Ä—Ç–∞–∂|report)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(–ø—Ä–æ–º–æ|promo)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(–æ—Ç—Ä—ã–≤–æ–∫|preview)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(–∞–Ω–æ–Ω—Å|announcement)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(—Å—ä–µ–º–∫–∏|making of|behind the scenes)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(—Å–±–æ—Ä–Ω–∏–∫|collection)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(–¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π|docu|documentary)(?=$|[^\p{L}\p{N}])/iu,/(?:^|[^\p{L}\p{N}])(–∫–æ–Ω—Ü–µ—Ä—Ç|concert|live)(?=$|[^\p{L}\p{N}])/iu,/movie\s*\d+/i,/film\s*\d+/i,/(?:^|[^\p{L}\p{N}])(–º—É–ª—å—Ç—Ñ–∏–ª—å–º|–∞–Ω–∏–º–µ-—Ñ–∏–ª—å–º|—Å–ø–µ—Ü—ç–ø–∏–∑–æ–¥|—Å–ø–µ—Ü—Å–µ—Ä—ñ—è)(?=$|[^\p{L}\p{N}])/iu,/\bepisode of\b/i];for(const e of n)if(e.test(t))return!0;return!1}function B(e,t,n){if("2x2"===String(n).toLowerCase().replace(/\s+/g,""))return!0;const r=e.slice(Math.max(0,t-12),t).toLowerCase(),s=e.slice(t+n.length,t+n.length+12).toLowerCase(),o=/(–¥–±|dub)\s*\(/i.test(r),a=/^\s*\)/.test(s);return o&&a}function U({season:e,seasonRange:t,episode:n,episodeRange:r,base:s,title:o}){if(o&&z(o))return 0;let a=s;const i=e??t?.start??null,l=n??r?.start??null;return null!=i&&(a+=10),null!=l&&(a+=10),null!=i&&null!=l&&(a+=15),t&&t.end!==t.start&&(a+=5),r&&r.end!==r.start&&(a+=5),null==i||P(i)||(a-=60),null==l||D(l)||(a-=60),u=a,Number.isFinite(u)?Math.max(0,Math.min(100,Math.round(u))):0;var u}function F(e){const t=function(e){if(null==e)return"";let t=String(e);return t=t.replace(/[\u2012\u2013\u2014\u2212]/g,"-"),t=t.replace(/—Ö/gi,"x"),t=t.replace(/\u00A0/g," "),t=t.replace(/\s+/g," ").trim(),t}(e),n=function(e){const t=/(?:^|[^\p{L}\p{N}])(?:–∏–∑|of)\s*(\d{1,4})(?=$|[^\p{L}\p{N}])/iu.exec(e);if(!t)return null;const n=T(t[1]);return D(n)?n:null}(t);if(z(t))return{season:null,episode:null,source:"trash",confidence:0};const r=[],s=[];{const e=/s(\d{1,2})\s*[ex](\d{1,3})(?:\s*[-]\s*[ex]?(\d{1,3}))?\b/i.exec(t);if(e){const t=T(e[1]),n=q(T(e[2]),T(e[3])),o=n?n.start:null;P(t)&&r.push({season:t,base:90,name:"SxxEyy"}),D(o)&&s.push({episode:o,episodeRange:n,base:90,name:"SxxEyy"})}}{const e=/\b(\d{1,2})\s*[-]\s*(\d{1,2})\s*x\s*(\d{1,3})(?:\s*[-]\s*(\d{1,4}))?\b/i.exec(t);if(e&&!B(t,e.index,e[0])){const t=T(e[1]),n=T(e[2]),o=T(e[3]),a=T(e[4]),i=q(t,n),l=q(o,a);i&&P(i.start)&&P(i.end)&&r.push({season:i.start,seasonRange:i.start!==i.end?i:void 0,base:92,name:"Srange x Erange"}),l&&D(l.start)&&D(l.end)&&s.push({episode:l.start,episodeRange:l.start!==l.end?l:void 0,base:92,name:"Srange x Erange"})}}{const e=/\b(\d{1,2})\s*x\s*(\d{1,3})(?:\s*[-]\s*(\d{1,3}))?\b/i.exec(t);if(e)if(B(t,e.index,e[0]));else{const t=T(e[1]),n=q(T(e[2]),T(e[3])),o=n?n.start:null;P(t)&&r.push({season:t,base:85,name:"xxXyy"}),D(o)&&s.push({episode:o,episodeRange:n,base:85,name:"xxXyy"})}}{const e=t.matchAll(/[\[\(]([^\]\)]+)[\]\)]?/g);for(const t of e){const e=t[1],n=/(\d{1,4})\s*[-]\s*(\d{1,4})/g;let r;for(;null!==(r=n.exec(e));){const t=T(r[1]),n=T(r[2]);if(null==t||null==n||j(t,n))continue;const o=e.slice(r.index+r[0].length,r.index+r[0].length+12).toLowerCase(),a=e.slice(Math.max(0,r.index-12),r.index).toLowerCase(),i=/(—ç–ø|ep|–∏–∑|of|tv|series|—Å–µ—Ä)/i.test(a+" "+o);if(!(i||Math.max(t,n)>=50))continue;const l=q(t,n),u=l?.start??null;s.push({episode:D(u)?u:null,episodeRange:l&&D(l.start)?l:void 0,base:i?75:70,name:"bracket range"})}const o=/(?:—ç–ø|ep|—Å–µ—Ä|—Å–µ—Ä–∏—è)\s*(\d{1,4})(?=$|[^\d])/i,a=/(?:^|[^\d])(\d{1,4})(?:\s*(?:–∏–∑|—ç–ø|ep|—Å–µ—Ä|of|from))(?=$|[^\d])/i.exec(e)||o.exec(e);if(a){const e=T(a[1]);D(e)&&s.push({episode:e,base:65,name:"bracket single"})}}}{const e=[{re:/(?:^|[^\p{L}\p{N}])(\d{1,2})(?:\s*[-]\s*(\d{1,2}))?\s*—Å–µ–∑–æ–Ω(?:–∞|—ã|—ñ–≤)?(?=$|[^\p{L}\p{N}])/iu,base:75,name:"N —Å–µ–∑–æ–Ω"},{re:/(?:^|[^\p{L}\p{N}])—Å–µ–∑–æ–Ω(?:–∞|—ã|–∏|—ñ–≤)?\s*(\d{1,2})(?:\s*[-]\s*(\d{1,2}))?(?=$|[^\p{L}\p{N}])/iu,base:70,name:"–°–µ–∑–æ–Ω N"},{re:/(?:^|[^\p{L}\p{N}])—Å–µ–∑–æ–Ω(?:–∞|—ã|–∏|—ñ–≤)?\s*:\s*(\d{1,2})(?:\s*[-]\s*(\d{1,2}))?/iu,base:66,name:"–°–µ–∑–æ–Ω: N"},{re:/\bseason\s*[: ]\s*(\d{1,2})(?:\s*[-]\s*(\d{1,2}))?\b/i,base:55,name:"Season:"},{re:/\bseason\s*(\d{1,2})\b/i,base:52,name:"Season N"},{re:/\[\s*s(\d{1,2})\s*\]/i,base:80,name:"[Sxx]"},{re:/\bs(\d{1,2})\b/i,base:50,name:"Sxx (season-only)"}];for(const{re:n,base:s,name:o}of e){const e=n.exec(t);if(!e)continue;if("–°–µ–∑–æ–Ω: N"===o){const n=t.slice(e.index+e[0].length,e.index+e[0].length+20).toLowerCase();if(/^[\s]* (—Å–µ—Ä|series|episode|—ç–ø–∏–∑)/i.test(n))continue}const a=T(e[1]),i=T(e[2]);if(null==a)continue;const l=q(a,i);r.push({season:l?.start??null,seasonRange:l&&l.end!==l.start?l:void 0,base:s,name:o})}}{const e=[{re:/(?:^|[^\p{L}\p{N}])(?:—Å–µ—Ä–∏–∏|—Å–µ—Ä—ñ—è|—Å–µ—Ä—ñ—ó|—ç–ø–∏–∑–æ–¥(?:—ã)?|episodes|—ç–ø\.?)\s*[: ]?\s*(\d{1,4})(?:\s*[-]\s*(\d{1,4}))?(?=$|[^\p{L}\p{N}])/iu,base:60,name:"—Å–µ—Ä—ñ—ó"},{re:/(?:^|[^\p{L}\p{N}])(\d{1,4})(?:\s*[-]\s*(\d{1,4}))?\s*(?:—Å–µ—Ä–∏–∏|—Å–µ—Ä—ñ—è|—Å–µ—Ä—ñ—ó|—ç–ø–∏–∑–æ–¥(?:—ã)?|—ç–ø\.?)(?=$|[^\p{L}\p{N}])/iu,base:62,name:"1-4 —Å–µ—Ä—ñ—ó"},{re:/(?:^|[^\p{L}\p{N}])(\d{1,4})\s*[-]\s*(\d{1,4})\s*—Å–µ—Ä–∏—è(?=$|[^\p{L}\p{N}])/iu,base:62,name:"1-4 —Å–µ—Ä—ñ—è"},{re:/(?:^|[^\p{L}\p{N}])(\d{1,4})\s*(?:—Å–µ—Ä–∏—è|—Å–µ—Ä—ñ—è)(?=$|[^\p{L}\p{N}])/iu,base:54,name:"N —Å–µ—Ä—ñ—è"},{re:/(?:—Å–µ—Ä–∏–∏|—Å–µ—Ä—ñ—ó)\s*(\d{1,4})\s*–∏–∑\s*(\d{1,4})/iu,base:65,name:"—Å–µ—Ä—ñ—ó X –∏–∑ Y"}];for(const{re:n,base:r,name:o}of e){const e=n.exec(t);if(!e)continue;const a=T(e[1]),i=T(e[2]);if(null==a)continue;const l=q(a,i);s.push({episode:l?.start??null,episodeRange:l&&l.end!==l.start?l:void 0,base:r,name:o})}}const o=r.sort(((e,t)=>t.base-e.base))[0]||null,a=s.sort(((e,t)=>t.base-e.base))[0]||null;if(o||a){const e=o?.season??null,r=a?.episode??null,s=o?.seasonRange,i=a?.episodeRange,l=null!=e&&P(e)?e:null,u=null!=r&&D(r)?r:null;return{season:l,seasonRange:s,episode:u,episodeRange:i,episodesTotal:n,episodesCount:i?i.end-i.start+1:null!=u?1:null,source:[o?.name,a?.name].filter(Boolean).join(" + ")||"heuristic",confidence:U({season:l,seasonRange:s,episode:u,episodeRange:i,base:Math.max(o?.base??0,a?.base??0),title:t})}}return{season:null,episode:null,source:"none",confidence:0}}function J(e,t,n=!1,r=1,s=!1){const o=e.Title||e.title||"",a=e.Size||e.size_bytes||0,i={source:null};if(s&&e.ffprobe&&Array.isArray(e.ffprobe)){const t=e.ffprobe.find((e=>"video"===e.codec_type));if(t){if(t.tags&&t.tags.BPS){const n=parseInt(t.tags.BPS,10);if(!isNaN(n)&&n>0)return i.source="ffprobe.tags.BPS",i.bps=n,i.mbps=Math.round(n/1e6),e._et_bitrate_debug=i,i.mbps}if(t.bit_rate){const n=parseInt(t.bit_rate,10);if(!isNaN(n)&&n>0)return i.source="ffprobe.video.bit_rate",i.bit_rate=n,i.mbps=Math.round(n/1e6),e._et_bitrate_debug=i,i.mbps}}}let u=t?.runtime||t?.duration||t?.episode_run_time;if(Array.isArray(u)&&(u=u.length>0?u[0]:0),!u&&n&&(u=45),a>0&&u>0){let t=1;if(n){const e=F(o);if(e&&e.episodesCount&&e.episodesCount>1)t=e.episodesCount;else if(r>1){a>(/\b2160p\b|4k\b/i.test(o)?32212254720:10737418240)&&(t=r)}}const s=60*u*t,d=8*a,c=d/Math.pow(1e3,2)/s,p=Math.round(c),m=l?.scoring_rules?.bitrate_bonus?.max_mbps_cap,g="number"==typeof m&&m>0?m:150;if(p>0)return i.source="size+duration",i.size_bytes=a,i.runtime_min=u,i.epCount=t,i.totalSeconds=s,i.bitSize_bits=d,i.mbps_raw=c,i.mbps_rounded=p,i.maxCap=g,i.mbps=Math.min(p,g),e._et_bitrate_debug=i,i.mbps}if(e.bitrate){const t=String(e.bitrate).match(/(\d+\.?\d*)/);if(t)return i.source="item.bitrate",i.raw=e.bitrate,i.mbps=Math.round(parseFloat(t[1])),e._et_bitrate_debug=i,i.mbps}const d=o.match(/(\d+\.?\d*)\s*(?:Mbps|–ú–±–∏—Ç)/i);return d?(i.source="title",i.raw=d[0],i.mbps=Math.round(parseFloat(d[1])),e._et_bitrate_debug=i,i.mbps):(i.source="unknown",e._et_bitrate_debug=i,0)}function H(e,t,n=!1,r=1){const s=(e.Title||e.title||"").toLowerCase(),o=[];if(e.ffprobe&&Array.isArray(e.ffprobe)){e.ffprobe.filter((e=>"audio"===e.codec_type)).forEach((e=>{const t=function(e){const t=e.tags||{},n=(t.title||t.handler_name||"").toLowerCase(),r=(t.language||"").toLowerCase(),s=X(r),o=[],a=function(){const e=l&&l.preferences&&Array.isArray(l.preferences.languages)?l.preferences.languages:[],t=new Set;return e.forEach((e=>{const n=X(e);n&&t.add(n)})),t}();if(s&&a.size&&!a.has(s))return o;return Y.forEach((e=>{const t=Array.isArray(e.aliases)?e.aliases:[],a=Array.isArray(e.languages)?e.languages:[];if(s&&a.length){if(!a.some((e=>String(e).toLowerCase()===s)))return}const i=!!s&&t.some((e=>{const t=String(e).toLowerCase();return t===s||r&&t===r})),l=t.some((e=>te(n,e)));(i||l)&&o.push(e.id)})),o}(e);t.forEach((e=>{o.includes(e)||o.push(e)}))}))}return Y.forEach((e=>{if(o.includes(e.id))return;if(0===e.id){return void((Array.isArray(e.aliases)?e.aliases:[]).filter((e=>String(e).trim().length<=3)).some((e=>te(s,e)))&&o.push(e.id))}if(1===e.id)return;(Array.isArray(e.aliases)?e.aliases:[]).some((e=>te(s,e)))&&o.push(e.id)})),{resolution:E(e),hdr_type:V(e),audio_tracks:o,audio_quality:I(e),bitrate:J(e,t,n,r)}}const G={rus:["rus","ru","russian"],ukr:["ukr","ua","ukrainian"],eng:["eng","en","english","und"]},K=(()=>{const e=Object.create(null);return Object.keys(G).forEach((t=>{(G[t]||[]).forEach((n=>{e[String(n).toLowerCase()]=t}))})),Object.keys(G).forEach((t=>e[t]=t)),e})();function X(e){if(!e)return null;const t=String(e).toLowerCase();return K[t]||t}const Y=[{id:0,type:"DUB",name:"–î—É–±–ª—è–∂ RU",aliases:["–¥–±","–¥—É–±–ª—è–∂","dub"],languages:["rus"]},{id:1,type:"DUB",name:"–î—É–±–ª—è–∂ UKR",aliases:["ukr","ua","—É–∫—Ä","—É–∫—Ä–∞","–¥—É–±–ª—è–∂"],languages:["ukr"]},{id:2,type:"DUB",name:"–î—É–±–ª—è–∂ –ü–∏—Ñ–∞–≥–æ—Ä",aliases:["–ø–∏—Ñ–∞–≥–æ—Ä"],languages:["rus"]},{id:3,type:"DUB",name:"–î—É–±–ª—è–∂ Red Head Sound",aliases:["red head sound","rhs"],languages:["rus"]},{id:4,type:"DUB",name:"–î—É–±–ª—è–∂ Videofilm",aliases:["videofilm"],languages:["rus"]},{id:5,type:"DUB",name:"–î—É–±–ª—è–∂ MovieDalen",aliases:["moviedalen"],languages:["rus"]},{id:6,type:"DUB",name:"–î—É–±–ª—è–∂ LeDoyen",aliases:["ledoyen"],languages:["rus","ukr"]},{id:7,type:"DUB",name:"–î—É–±–ª—è–∂ Whiskey Sound",aliases:["whiskey sound"],languages:["rus"]},{id:8,type:"DUB",name:"–î—É–±–ª—è–∂ IRON VOICE",aliases:["iron voice"],languages:["rus"]},{id:9,type:"DUB",name:"–î—É–±–ª—è–∂ AlexFilm",aliases:["alexfilm"],languages:["rus"]},{id:10,type:"DUB",name:"–î—É–±–ª—è–∂ Amedia",aliases:["amedia"],languages:["rus"]},{id:11,type:"MVO",name:"MVO HDRezka",aliases:["hdrezka","rezka","hdrezka studio","rezka studio"],languages:["rus","ukr"]},{id:12,type:"MVO",name:"MVO LostFilm",aliases:["lostfilm","lf"],languages:["rus"]},{id:13,type:"MVO",name:"MVO TVShows",aliases:["tvshows","tv shows"],languages:["rus"]},{id:14,type:"MVO",name:"MVO Jaskier",aliases:["jaskier","–∂–∞—Å–∫–∏—Ä"],languages:["rus"]},{id:15,type:"MVO",name:"MVO RuDub",aliases:["rudub"],languages:["rus"]},{id:16,type:"MVO",name:"MVO LE-Production",aliases:["le-production","le production"],languages:["rus"]},{id:17,type:"MVO",name:"MVO –ö—É–±–∏–∫ –≤ –ö—É–±–µ",aliases:["–∫—É–±–∏–∫ –≤ –∫—É–±–µ"],languages:["rus"]},{id:18,type:"MVO",name:"MVO NewStudio",aliases:["newstudio","new studio","–Ω—å—é —Å—Ç—É–¥–∏–æ"],languages:["rus"]},{id:19,type:"MVO",name:"MVO Good People",aliases:["good people"],languages:["rus"]},{id:20,type:"MVO",name:"MVO IdeaFilm",aliases:["ideafilm","idea film"],languages:["rus"]},{id:21,type:"MVO",name:"MVO AMS",aliases:["ams"],languages:["rus"]},{id:22,type:"MVO",name:"MVO Baibako",aliases:["baibako"],languages:["rus","ukr"]},{id:23,type:"MVO",name:"MVO Profix Media",aliases:["profix media","profix"],languages:["rus"]},{id:24,type:"MVO",name:"MVO NewComers",aliases:["newcomers","new comers"],languages:["rus"]},{id:25,type:"MVO",name:"MVO GoLTFilm",aliases:["goltfilm","golt film"],languages:["rus"]},{id:26,type:"MVO",name:"MVO JimmyJ",aliases:["jimmyj","jimmy j"],languages:["rus"]},{id:27,type:"MVO",name:"MVO Kerob",aliases:["kerob"],languages:["rus"]},{id:28,type:"MVO",name:"MVO LakeFilms",aliases:["lakefilms","lake films"],languages:["rus"]},{id:29,type:"MVO",name:"MVO Twister",aliases:["twister"],languages:["rus"]},{id:30,type:"MVO",name:"MVO Voice Project",aliases:["voice project"],languages:["rus"]},{id:31,type:"MVO",name:"MVO Dragon Money Studio",aliases:["dragon money","dms"],languages:["rus"]},{id:32,type:"MVO",name:"MVO Syncmer",aliases:["syncmer"],languages:["rus"]},{id:33,type:"MVO",name:"MVO ColdFilm",aliases:["coldfilm","cold film"],languages:["rus"]},{id:34,type:"MVO",name:"MVO SunshineStudio",aliases:["sunshinestudio","sunshine studio"],languages:["rus"]},{id:35,type:"MVO",name:"MVO Ultradox",aliases:["ultradox"],languages:["rus"]},{id:36,type:"MVO",name:"MVO Octopus",aliases:["octopus"],languages:["rus"]},{id:37,type:"MVO",name:"MVO OMSKBIRD",aliases:["omskbird records","omskbird"],languages:["rus"]},{id:38,type:"AVO",name:"AVO –í–æ–ª–æ–¥–∞—Ä—Å–∫–∏–π",aliases:["–≤–æ–ª–æ–¥–∞—Ä—Å–∫–∏–π"],languages:["rus"]},{id:39,type:"AVO",name:"AVO –Ø—Ä–æ—Ü–∫–∏–π",aliases:["—è—Ä–æ—Ü–∫–∏–π","–º. —è—Ä–æ—Ü–∫–∏–π"],languages:["rus"]},{id:40,type:"AVO",name:"AVO –°–µ—Ä–±–∏–Ω",aliases:["—Å–µ—Ä–±–∏–Ω","—é. —Å–µ—Ä–±–∏–Ω"],languages:["rus"]},{id:41,type:"PRO",name:"PRO Gears Media",aliases:["gears media"],languages:["rus"]},{id:42,type:"PRO",name:"PRO Hamsterstudio",aliases:["hamsterstudio","hamster"],languages:["rus"]},{id:43,type:"PRO",name:"PRO P.S.Energy",aliases:["p.s.energy","ps energy","p s energy"],languages:["rus"]},{id:44,type:"UKR",name:"UKR –ù–µ–ó—É–ø–∏–Ω—è–π–ü—Ä–æ–¥–∞–∫—à–Ω",aliases:["–Ω–µ–∑—É–ø–∏–Ω—è–π–ø—Ä–æ–¥–∞–∫—à–Ω","–Ω–µ–∑—É–ø–∏–Ω—è–π","nezupyniai"],languages:["ukr"]},{id:45,type:"ORIG",name:"Original",aliases:["original","eng","english"],languages:["eng"]}],Q=new Map,Z=new Map,W=new Set;function ee(e){if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return Q.has(e)?e:null;const t=String(e).trim();if(!t)return null;if(/^\d+$/.test(t)){const e=parseInt(t,10);return Q.has(e)?e:null}const n=Z.get(t.toLowerCase());return"number"==typeof n?n:null}function te(e,t){if(!e||!t)return!1;const n=String(e).toLowerCase(),r=String(t).toLowerCase();if(!r)return!1;if(r.length<=3){const e=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");try{return new RegExp(`(?:^|[^\\p{L}\\p{N}])${e}(?=$|[^\\p{L}\\p{N}])`,"iu").test(n)}catch(t){return new RegExp(`(?:^|[^a-z0-9_])${e}(?=$|[^a-z0-9_])`,"i").test(n)}}return n.includes(r)}function ne(e,t){if(!Lampa.Storage.get("easytorrent_enabled",!0))return;if(!e.Results||!Array.isArray(e.Results))return;console.log("[EasyTorrent] –û—Ç—Ä–∏–º–∞–Ω–æ –≤—ñ–¥ –ø–∞—Ä—Å–µ—Ä–∞:",e.Results.length,"—Ç–æ—Ä—Ä–µ–Ω—Ç—ñ–≤");const n=t?.movie,r=!(!n||!(n.original_name||n.number_of_seasons>0||n.seasons)),s=(()=>{if(!r||!n)return null;const e=n.number_of_seasons?n.original_name:n.original_title;if(!e)return{season:1,episode:1,hasHistory:!1};const t=Lampa.Utils&&"function"==typeof Lampa.Utils.hash?Lampa.Utils.hash(e):String(e),s=Lampa.Storage.get("online_watched_last",{});let o=s;if("string"==typeof s)try{o=JSON.parse(s)}catch(e){o={}}const a=o&&o[t]?o[t]:null;return{season:a&&Number.isFinite(parseInt(a.season,10))?parseInt(a.season,10):1,episode:a&&Number.isFinite(parseInt(a.episode,10))?parseInt(a.episode,10):1,hasHistory:!!a}})(),o=(e,t,n)=>{if(!e)return!1;let r=!1;return r=e.seasonRange?t>=e.seasonRange.start&&t<=e.seasonRange.end:Number.isInteger(e.season)?e.season===t:1===t,!!r&&(e.episodeRange?n>=e.episodeRange.start&&n<=e.episodeRange.end:!Number.isInteger(e.episode)||e.episode===n)};let a=1;if(r){let t=1;e.Results.forEach((e=>{const n=F(e.Title||e.title||"");n&&n.episodesCount&&n.episodesCount>t&&(t=n.episodesCount)})),a=t,a>1&&Lampa.Storage.get("easytorrent_debug",!1)&&console.log(`[EasyTorrent][Debug] –†–µ–∂–∏–º —Å–µ—Ä—ñ–∞–ª–∞. –ê–Ω–∞–ª—ñ–∑: –ú–∞–∫—Å-–¥–∏–∞–ø–∞–∑–æ–Ω —Å–µ—Ä—ñ–π –≤ –ø–∞–∫—É=${t}. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º=${a}`)}const i=function(){const e=l,t=e.scoring_rules;return function(n){let r="number"==typeof t.base_score?t.base_score:100;const s=n.features,o=n.Seeds||n.seeds||n.Seeders||n.seeders||0;let a={base:r,resolution:0,hdr:0,bitrate:0,availability:0,audio_track:0,audio_quality:0,special:0};const i=t.resolution&&(t.resolution[s.resolution]||t.resolution[String(s.resolution)])||0;a.resolution=i,r+=i;let l=t.hdr&&t.hdr[s.hdr_type]||0;a.hdr=l,r+=l;let u=0;if(s.bitrate>0){const e=t.bitrate_bonus&&Array.isArray(t.bitrate_bonus.thresholds)?t.bitrate_bonus.thresholds:[];for(const t of e)if(s.bitrate>=t.min&&s.bitrate<t.max){u=t.bonus||0;break}}else u=t.bitrate_bonus&&"number"==typeof t.bitrate_bonus.missing_penalty?t.bitrate_bonus.missing_penalty:0;a.bitrate=u,r+=u;const d=Array.isArray(e.audio_track_priority)?e.audio_track_priority:[],c=Array.isArray(s.audio_tracks)?s.audio_tracks:[];let p=0;if(d.length&&c.length){const e=new Set(c.filter((e=>"number"==typeof e&&Number.isFinite(e))));for(let n=0;n<d.length;n++){const r=d[n];if("number"!=typeof r||!Number.isFinite(r))continue;if(!e.has(r))continue;const s=t.audio_track&&"number"==typeof t.audio_track.max_points?t.audio_track.max_points:0,o=d.length;p=s*(o<=1?1:1-n/(o-1));break}}a.audio_track=p,r+=p;const m=s.audio_quality||"unknown",g=t.audio_quality&&t.audio_quality.points&&"number"==typeof t.audio_quality.points[m]?t.audio_quality.points[m]:t.audio_quality&&t.audio_quality.points&&"number"==typeof t.audio_quality.points.unknown?t.audio_quality.points.unknown:0;a.audio_quality=g,r+=g;let f=0;if(o<(t.availability&&"number"==typeof t.availability.min_seeds?t.availability.min_seeds:e.preferences?.min_seeds||1))f=t.availability&&"number"==typeof t.availability.below_min_penalty?t.availability.below_min_penalty:0;else{const e=t.availability&&"number"==typeof t.availability.log10_multiplier?t.availability.log10_multiplier:0;f=Math.log10(o+1)*e}if(a.availability=f,r+=f,Array.isArray(t.special_rules)&&t.special_rules.length){let e=0;for(const n of t.special_rules){if(!n||"object"!=typeof n)continue;const t=n.if||n.when;if(!t||"object"!=typeof t)continue;let r=!0;"number"==typeof t.resolution&&(r=r&&s.resolution===t.resolution),"number"==typeof t.bitrate_min&&(r=r&&s.bitrate>=t.bitrate_min),"number"==typeof t.seeds_min&&(r=r&&o>=t.seeds_min),"string"==typeof t.hdr_type&&(r=r&&s.hdr_type===t.hdr_type),"string"==typeof t.audio_quality&&(r=r&&(s.audio_quality||"unknown")===t.audio_quality),r&&(e+="number"==typeof n.bonus?n.bonus:0)}a.special=e,r+=e}if(r=Math.max(0,Math.round(r)),Lampa.Storage.get("easytorrent_show_scores",!1)){const t=(n.Title||n.title||"").substring(0,80);console.log("[Score]",t,{total:r,breakdown:a,features:{resolution:s.resolution,hdr_type:s.hdr_type,bitrate:s.bitrate,audio_tracks:s.audio_tracks,audio_quality:s.audio_quality},seeds:o,paramPriority:(e.parameter_priority||[]).slice(0,3)})}return{score:r,breakdown:a}}}(),u=e.Results.map(((e,t)=>{const s=H(e,n,r,a),o=i({...e,features:s});return{element:e,originalIndex:t,features:s,score:o.score,breakdown:o.breakdown}}));console.log("[EasyTorrent] –£—Å—ñ —Ç–æ—Ä–µ–Ω—Ç–∏ –æ—Ü—ñ–Ω–µ–Ω—ñ"),u.sort(((e,t)=>{if(t.score!==e.score)return t.score-e.score;if(t.features.bitrate!==e.features.bitrate)return t.features.bitrate-e.features.bitrate;const n=e.element.Seeds||e.element.seeds||e.element.Seeders||e.element.seeders||0;return(t.element.Seeds||t.element.seeds||t.element.Seeders||t.element.seeders||0)-n})),u.length>0&&(console.log("=== –í–°–Ü –¢–û–†–†–ï–ù–¢–ò (–≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ –ø–æ score) ==="),u.forEach(((e,t)=>{const n=e.element.Seeds||e.element.seeds||e.element.Seeders||e.element.seeders||0,r=e.breakdown,s=e.element.Title.substring(0,100),o=[];void 0!==r.audio_track&&0!==r.audio_track&&o.push(`A:${r.audio_track>0?"+":""}${Math.round(r.audio_track)}`),void 0!==r.audio_quality&&0!==r.audio_quality&&o.push(`AQ:${r.audio_quality>0?"+":""}${Math.round(r.audio_quality)}`),void 0!==r.resolution&&0!==r.resolution&&o.push(`R:${r.resolution>0?"+":""}${Math.round(r.resolution)}`),void 0!==r.bitrate&&0!==r.bitrate&&o.push(`B:${r.bitrate>0?"+":""}${Math.round(r.bitrate)}`),void 0!==r.availability&&0!==r.availability&&o.push(`S:${r.availability>0?"+":""}${Math.round(r.availability)}`),void 0!==r.hdr&&0!==r.hdr&&o.push(`H:${r.hdr>0?"+":""}${Math.round(r.hdr)}`),void 0!==r.special&&0!==r.special&&o.push(`SP:${r.special>0?"+":""}${Math.round(r.special)}`);const a=o.length>0?`[${o.join(" ")}]`:"[no breakdown]";console.log(`${t+1}. [${e.score}] ${e.features.resolution||"?"}p ${e.features.hdr_type} ${e.features.bitrate}mb Seeds:${n} ${a} | ${s}`)})),console.log(`=== –í–°–¨–û–ì–û: ${u.length} —Ç–æ—Ä—Ä–µ–Ω—Ç—ñ–≤ ===`));l.preferences.recommendation_count;const d=l.preferences.min_seeds||2;u.filter((e=>(e.element.Seeds||e.element.seeds||e.element.Seeders||e.element.seeders||0)>=d));u.forEach((e=>{if(e.element._recommendScore=e.score,e.element._recommendBreakdown=e.breakdown,e.element._recommendFeatures=e.features,r&&s){const t=e.element.Title||e.element.title||"";e.element._recommendEpisodePriority=((e,t,n)=>{if(!r||!s)return 0;const a=F(e||"");return o(a,t,n)?o(a,t,n+1)?2:1:0})(t,s.season,s.episode)}else e.element._recommendEpisodePriority=0})),console.log("[EasyTorrent] –£—Å—ñ —Ç–æ—Ä–µ–Ω—Ç–∏ –ø—Ä–æ–º–∞—Ä–∫–æ–≤–∞–Ω—ñ –±–∞–ª–∞–º–∏"),console.log("[EasyTorrent] –¢–æ–ø-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑–±–µ—Ä–µ–∂–µ–Ω–æ")}function re(e){if(!Lampa.Storage.get("easytorrent_enabled",!0))return;const{element:t,item:n}=e,r=Lampa.Storage.get("easytorrent_show_scores",!0),s=Lampa.Storage.get("easytorrent_debug",!1);if(void 0===t._recommendRank)return;n.find(".torrent-recommend-badge").remove(),n.find(".torrent-recommend-panel").remove();const o=t._recommendRank,a=t._recommendScore,i=t._recommendBreakdown||{},u=l.preferences.recommendation_count||3;if(!(t._recommendIsIdeal||o<u||r||s))return;const d=t._recommendFeatures||{},c=[];d.resolution&&c.push(`${d.resolution}p`),d.hdr_type&&c.push({dolby_vision:"DV",hdr10plus:"HDR10+",hdr10:"HDR10",sdr:"SDR"}[d.hdr_type]||String(d.hdr_type).toUpperCase()),d.bitrate&&c.push(`${d.bitrate} Mbps`);let p="neutral",m="";t._recommendIsIdeal?(p="ideal",m=h("ideal_badge")):o<u?(p="recommended",m=`${h("recommended_badge")} ‚Ä¢ #${o+1}`):(p="neutral",m="–û—Ü—ñ–Ω–∫–∞");const g=$(`<div class="torrent-recommend-panel torrent-recommend-panel--${p}"></div>`),f=$('<div class="torrent-recommend-panel__left"></div>');f.append(`<div class="torrent-recommend-panel__label">${m}</div>`),c.length&&f.append(`<div class="torrent-recommend-panel__meta">${c.join(" ‚Ä¢ ")}</div>`);const y=$('<div class="torrent-recommend-panel__right"></div>');if(r&&void 0!==a&&y.append(`<div class="torrent-recommend-panel__score">${a}</div>`),g.append(f),r){const e=function(e){if(!e||0===Object.keys(e).length)return"";const t=$('<div class="torrent-recommend-panel__chips"></div>');return[{key:"audio_track",name:"–û–∑–≤—É—á–∫–∞"},{key:"audio_quality",name:"–ó–≤—É–∫"},{key:"resolution",name:"–†–æ–∑–¥.–∑–¥–∞—Ç–Ω."},{key:"bitrate",name:"–ë—ñ—Ç—Ä–µ–π—Ç"},{key:"availability",name:"–°—ñ–¥–∏"},{key:"hdr",name:"HDR"},{key:"special",name:"–ë–æ–Ω—É—Å"}].forEach((n=>{if(void 0===e[n.key]||0===e[n.key])return;const r=Math.round(e[n.key]),s=r>0?"+":"",o=r>=0?"tr-chip--pos":"tr-chip--neg";t.append(`\n                <div class="tr-chip ${o}">\n                    <span class="tr-chip__name">${n.name}</span>\n                    <span class="tr-chip__val">${s}${r}</span>\n                </div>\n            `)})),t}(i);e&&g.append(e)}if(g.append(y),n.append(g),s){const e=[],n=t._et_resolution_debug;n&&d.resolution?"ffprobe"===n.source?e.push(`Resolution: ${d.resolution}p (ffprobe ${n.width||"?"}x${n.height||"?"})`):e.push(`Resolution: ${d.resolution}p (title)`):d.resolution&&e.push(`Resolution: ${d.resolution}p`);const r=t._et_hdr_debug;if(d.hdr_type)if(r&&"title"===r.source){const t=Array.isArray(r.foundTypes)?r.foundTypes.join(","):"";e.push(`HDR: ${d.hdr_type} (title tokens: ${t||"none"} ‚Üí ${r.chosen||d.hdr_type})`)}else e.push(`HDR: ${d.hdr_type}`);const s=t._et_bitrate_debug;if("number"==typeof d.bitrate&&(e.push(`Bitrate: ${d.bitrate} Mbps`),s&&s.source&&(e.push(`Bitrate source: ${s.source}`),"size+duration"===s.source&&(e.push("Bitrate formula: round(((sizeBytes*8)/1e6) / (runtimeMin*60*epCount))"),e.push(`  sizeBytes=${s.size_bytes}  runtimeMin=${s.runtime_min}  epCount=${s.epCount}  totalSeconds=${s.totalSeconds}`),e.push(`  mbpsRaw=${Number.isFinite(s.mbps_raw)?s.mbps_raw.toFixed(4):s.mbps_raw}  mbpsRounded=${s.mbps_rounded}  cap=${s.maxCap}  mbpsFinal=${s.mbps}`)))),Array.isArray(d.audio_tracks)&&d.audio_tracks.length){const t=d.audio_tracks.map((e=>Q&&Q.get&&Q.get(e)?Q.get(e).name:String(e))).join(", ");e.push(`Audio tracks: ${t}`)}void 0!==t._recommendEpisodePriority&&(t._recommendEpisodePriority||0)>0?e.push(`Episode priority: ${t._recommendEpisodePriority}`):void 0!==t._recommendEpisodePriority&&e.push("Episode priority: 0");const o=$('<div class="torrent-recommend-panel__debug"></div>');o.css({"white-space":"pre-wrap","font-size":"0.85em","line-height":"1.25",opacity:"0.9","margin-top":"0.4em"}),o.text(e.join("\n")),g.append(o)}}function se(){void 0===Lampa.Storage.get("easytorrent_enabled")&&Lampa.Storage.set("easytorrent_enabled",!0),void 0===Lampa.Storage.get("easytorrent_show_scores")&&Lampa.Storage.set("easytorrent_show_scores",!0),void 0===Lampa.Storage.get("easytorrent_debug")&&Lampa.Storage.set("easytorrent_debug",!1),Lampa.SettingsApi.addComponent({component:"easytorrent",name:e,icon:n}),Lampa.SettingsApi.addParam({component:"easytorrent",param:{name:"easytorrent_about",type:"static"},field:{name:"<div>"+e+" "+t+"</div>"},onRender:function(e){e.css("opacity","0.7"),e.find(".settings-param__name").css({"font-size":"1.2em","margin-bottom":"0.3em"}),e.append('<div style="font-size: 0.9em; padding: 0 1.2em; line-height: 1.4;">–ê–≤—Ç–æ—Ä: DarkestClouds<br>–ü–µ—Ä–µ–∫–ª–∞–¥: cevamnelampaplugin<br>–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π —Ç–æ—Ä–µ–Ω—Ç—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —è–∫–æ—Å—Ç—ñ, HDR —ñ –æ–∑–≤—É—á–∫–∏</div>')}}),Lampa.SettingsApi.addParam({component:"easytorrent",param:{name:"easytorrent_enabled",type:"trigger",default:!0},field:{name:h("easytorrent_title"),description:h("easytorrent_desc")},onChange:e=>{"true"===String(e)&&S()}}),Lampa.SettingsApi.addParam({component:"easytorrent",param:{name:"easytorrent_show_scores",type:"trigger",default:!0},field:{name:h("show_scores"),description:h("show_scores_desc")}}),Lampa.SettingsApi.addParam({component:"easytorrent",param:{name:"easytorrent_debug",type:"trigger",default:!1},field:{name:"–í—ñ–¥–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è",description:"–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —É –∫–∞—Ä—Ç—Ü—ñ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞ –ø–æ–¥—Ä–æ–±–∏—Ü—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤ (HDR/—Å–µ—Ä—ñ—ó/–±—ñ—Ç—Ä–µ–π—Ç –∏ —Ç.–ø.)"}}),Lampa.SettingsApi.addParam({component:"easytorrent",param:{name:"easytorrent_config_json",type:"static",default:JSON.stringify(i)},field:{name:h("config_json"),description:h("config_json_desc")},onRender:e=>{const t=()=>{const t=l,n=`${t.device.type.toUpperCase()} | ${t.parameter_priority[0]}`;e.find(".settings-param__value").text(n)};t(),e.on("hover:enter",(()=>{Lampa.Select.show({title:h("config_json"),items:[{title:h("config_view"),action:"view"},{title:h("config_edit"),action:"edit"},{title:h("config_reset"),action:"reset"}],onSelect:e=>{"view"===e.action?R():"edit"===e.action?Lampa.Input.edit({value:Lampa.Storage.get("easytorrent_config_json")||JSON.stringify(i),free:!0},(e=>{if(e)try{const n=O(JSON.parse(e));if(!n.ok)throw new Error(n.error);A(e),t(),Lampa.Noty.show("OK")}catch(e){Lampa.Noty.show(e&&e.message?e.message:h("config_error"))}Lampa.Controller.toggle("settings")})):"reset"===e.action&&(A(i),t(),Lampa.Noty.show("OK"),Lampa.Controller.toggle("settings"))},onBack:()=>{Lampa.Controller.toggle("settings")}})}))}}),Lampa.SettingsApi.addParam({component:"easytorrent",param:{name:"easytorrent_qr_setup",type:"static"},field:{name:"–†–∞—Å—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã",description:"–í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤—ñ–∑–∞—Ä–¥ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ —á–µ—Ä–µ–∑ QR-–∫–æ–¥"},onRender:e=>{e.on("hover:enter",(()=>{!function(){const e=function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let n=0;n<6;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}(),t=`${o}?pairCode=${e}`,n=$(`\n            <div class="about">\n                <div style="text-align: center; margin-bottom: 20px;">\n                    <div id="qrCodeContainer" style="background: white; padding: 20px; border-radius: 15px; display: inline-block; margin-bottom: 20px;height: 20em;width: 20em;"></div>\n                </div>\n                <div class="about__text" style="text-align: center; margin-bottom: 15px;">\n                    <strong>–ê–±–æ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –≤—Ä—É—á–Ω—É:</strong><br>\n                    <span style="word-break: break-all;">${t}</span>\n                </div>\n                <div class="about__text" style="text-align: center;">\n                    <strong>–ö–æ–¥ —Å–ø–æ–ª—É—á–µ–Ω–Ω—è:</strong>\n                    <div style="font-size: 2em; font-weight: bold; letter-spacing: 0.3em; margin: 10px 0; color: #667eea;">${e}</div>\n                </div>\n                <div class="about__text" id="qrStatus" style="text-align: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-top: 20px;">\n                    ‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó...\n                </div>\n            </div>\n        `);Lampa.Modal.open({title:"üîó –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤",html:n,size:"medium",onBack:()=>{a&&(clearInterval(a),a=null),Lampa.Modal.close(),Lampa.Controller.toggle("settings_component")}}),setTimeout((()=>{const e=document.getElementById("qrCodeContainer");if(e&&Lampa.Utils&&Lampa.Utils.qrcode)try{Lampa.Utils.qrcode(t,e)}catch(t){e.innerHTML='<p style="color: #f44336;">–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó QR-–∫–æ–¥–∞</p>'}}),100);let i=null;a=setInterval((async()=>{const t=await async function(e){try{const t=`${r}/rest/v1/tv_configs?id=eq.${encodeURIComponent(e)}&select=data,updated_at`,n=await fetch(t,{headers:{apikey:s,Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error(`Fetch failed: ${n.status}`);const o=await n.json();return o.length?o[0].data:null}catch(e){return console.error("[EasyTorrent] Fetch error:",e),null}}(e);if(t){const e=t.generated;e!==i&&(i=e,A(t),$("#qrStatus").html("‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –æ—Ç—Ä–∏–º–∞–Ω–∞ —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞!").css("color","#4CAF50"),setTimeout((()=>{a&&(clearInterval(a),a=null),Lampa.Modal.close(),Lampa.Noty.show("–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–∞!"),Lampa.Controller.toggle("settings_component")}),2e3))}}),5e3)}()}))}})}function oe(){const e=window.Lampa.Parser||(window.Lampa.Component?window.Lampa.Component.Parser:null);if(!e||!e.get)return void console.log("[EasyTorrent] Parser –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π –∞–±–æ –Ω–µ –º–∞—î –º–µ—Ç–æ–¥–∞ get");console.log("[EasyTorrent] –ü–∞—Ç—á–∏–º Parser.get –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—É —ñ —Ñ—ñ–∫—Å–∞—Ü—ñ—ó —Ç–æ–ø—ñ–≤");const t=e.get;e.get=function(e,n,r){return t.call(this,e,(function(t){if(t&&t.Results&&Array.isArray(t.Results)){ne(t,e);let n=t.Results;const r=e=>{if(!Array.isArray(e)||0===e.length)return e;const t=l.preferences.recommendation_count||3,n=l.preferences.min_seeds||0;let r=[...e].filter((e=>{const t=e.Seeds||e.seeds||e.Seeders||e.seeders||0;return(e._recommendScore||0)>0&&t>=n}));r.reduce(((e,t)=>Math.max(e,t._recommendEpisodePriority||0)),0)>=1&&(r=r.filter((e=>(e._recommendEpisodePriority||0)>=1)));const s=r.sort(((e,t)=>{const n=e._recommendEpisodePriority||0,r=t._recommendEpisodePriority||0;return r!==n?r-n:(t._recommendScore||0)-(e._recommendScore||0)})).slice(0,t);if(0===s.length)return e.forEach((e=>e._recommendRank=999)),e;const o=Array.prototype.filter.call(e,(e=>!s.includes(e))),a=[...s,...o];return a.forEach(((e,t)=>{e._recommendRank=t,e._recommendIsIdeal=0===t&&(e._recommendScore||0)>=150})),o.forEach((e=>e._recommendRank=999)),a},s=e=>{if(!e||e._recommendPatched)return e;const t=e.sort;e.sort=function(){t.apply(this,arguments);const e=r(this);for(let t=0;t<e.length;t++)this[t]=e[t];return this};const n=e.filter;return e.filter=function(){const e=n.apply(this,arguments),t=r(e);return s(t)},e._recommendPatched=!0,e};n=s(r(n));try{Object.defineProperty(t,"Results",{get:()=>n,set:e=>{n=s(r(e))},configurable:!0,enumerable:!0}),console.log("[EasyTorrent] –†–æ–∑—É–º–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞")}catch(e){console.log("[EasyTorrent] –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ñ—ñ–∫—Å–∞—Ü—ñ—ó —Ç–æ–ø—ñ–≤:",e)}}return n.apply(this,arguments)}),r)},console.log("[EasyTorrent] Parser.get –ø—Ä–æ–ø–∞—Ç—á–µ–Ω–æ!")}function ae(){console.log("[EasyTorrent]",t),function(){try{const e=Lampa.Storage.get("plugins","[]"),t=Array.isArray(e)?e.slice():"string"==typeof e?JSON.parse(e):[];if(!Array.isArray(t)||!t.length)return;let n=!1;const r=e=>{const t=String(e||"").toLowerCase();return!!t&&_.some((e=>t.includes(String(e).toLowerCase())))},s=t.map((e=>"string"==typeof e?{url:e,status:1}:e));s.forEach((e=>{if(!e||"object"!=typeof e)return;const t=e.url||e.link;r(t)&&(e.name||(e.name=f,n=!0),e.author||(e.author=y,n=!0),e.descr||(e.descr=String(t||"").replace(/\n|\t|\r/g," "),n=!0))})),n&&Lampa.Storage.set("plugins",s);try{const e=document&&document.querySelector?document.querySelector(".extensions"):null;e&&e.querySelectorAll(".extensions__item").forEach((e=>{const t=e.querySelector(".extensions__item-descr");if(!t)return;const n=String(t.textContent||"");if(!r(n))return;const s=e.querySelector(".extensions__item-name"),o=e.querySelector(".extensions__item-author");!s||s.textContent&&"–ë–µ–∑ –Ω–∞–∑–≤–∏"!==s.textContent.trim()||(s.textContent=f),!o||o.textContent&&"@lampa"!==o.textContent.trim()||(o.textContent=y)}))}catch(e){}}catch(e){console.warn("[EasyTorrent] ensureSelfPluginMetadataInStorage failed:",e)}}(),function(){const e=Lampa.Storage.get(c);if(e)try{const t="string"==typeof e?JSON.parse(e):e,n=O(t);return n.ok?void(l=t):(p=!0,w(),void console.warn("[EasyTorrent] –ö–æ–Ω—Ñ—ñ–≥ –≤—ñ–¥—Ö–∏–ª–µ–Ω–∏–π:",n.error))}catch(e){return p=!0,w(),void console.warn("[EasyTorrent] –ö–æ–Ω—Ñ—ñ–≥ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π —ñ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–∏–π:",e)}m=!0,w()}(),function(){const e=document.createElement("style");e.textContent='\n/* –ü–∞–Ω–µ–ª—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π (—Ñ—É—Ç–µ—Ä –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ .torrent-item) */\n.torrent-recommend-panel{\n    display: flex;\n    align-items: center;\n    gap: 0.9em;\n    margin: 0.8em -1em -1em;        /* "–ø—Ä–∏–∫–ª–µ—é—î–º–æ" –¥–æ –∫—Ä–∞—ó–≤ –∫–∞—Ä—Ç–æ—á–∫–∏ */\n    padding: 0.75em 1em 0.85em;\n    border-radius: 0 0 0.3em 0.3em; /* —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å torrent-item */\n    border-top: 1px solid rgba(255,255,255,0.10);\n    background: rgba(0,0,0,0.18);\n    backdrop-filter: blur(6px);\n    -webkit-backdrop-filter: blur(6px);\n}\n\n.torrent-recommend-panel__left{\n    min-width: 0;\n    flex: 1 1 auto;\n}\n\n.torrent-recommend-panel__label{\n    font-size: 0.95em;\n    font-weight: 800;\n    letter-spacing: 0.2px;\n    color: rgba(255,255,255,0.92);\n    line-height: 1.15;\n}\n\n.torrent-recommend-panel__meta{\n    margin-top: 0.25em;\n    font-size: 0.82em;\n    font-weight: 600;\n    color: rgba(255,255,255,0.58);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.torrent-recommend-panel__right{\n    flex: 0 0 auto;\n    display: flex;\n    align-items: center;\n}\n\n.torrent-recommend-panel__score{\n    font-size: 1.05em;\n    font-weight: 900;\n    padding: 0.25em 0.55em;\n    border-radius: 0.6em;\n    background: rgba(255,255,255,0.10);\n    border: 1px solid rgba(255,255,255,0.12);\n    color: rgba(255,255,255,0.95);\n}\n\n/* –ß—ñ–ø—Å–∏ breakdown */\n.torrent-recommend-panel__chips{\n    display: flex;\n    flex: 2 1 auto;\n    gap: 0.45em;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n}\n\n.torrent-recommend-panel__chips:empty{\n    display: none;\n}\n\n.tr-chip{\n    display: inline-flex;\n    align-items: baseline;\n    gap: 0.35em;\n    padding: 0.28em 0.55em;\n    border-radius: 999px;\n    background: rgba(255,255,255,0.08);\n    border: 1px solid rgba(255,255,255,0.10);\n}\n\n.tr-chip__name{\n    font-size: 0.78em;\n    font-weight: 700;\n    color: rgba(255,255,255,0.60);\n}\n\n.tr-chip__val{\n    font-size: 0.86em;\n    font-weight: 900;\n    color: rgba(255,255,255,0.92);\n}\n\n.tr-chip--pos{\n    background: rgba(76,175,80,0.10);\n    border-color: rgba(76,175,80,0.22);\n}\n.tr-chip--pos .tr-chip__val{ color: rgba(120,255,170,0.95); }\n\n.tr-chip--neg{\n    background: rgba(244,67,54,0.10);\n    border-color: rgba(244,67,54,0.22);\n}\n.tr-chip--neg .tr-chip__val{ color: rgba(255,120,120,0.95); }\n\n/* –í–∞—Ä–∏–∞–Ω—Ç—ã */\n.torrent-recommend-panel--ideal{\n    background: linear-gradient(135deg, rgba(255,215,0,0.16) 0%, rgba(255,165,0,0.08) 100%);\n    border-top-color: rgba(255,215,0,0.20);\n}\n.torrent-recommend-panel--ideal .torrent-recommend-panel__label{\n    color: rgba(255,235,140,0.98);\n}\n\n.torrent-recommend-panel--recommended{\n    background: rgba(76,175,80,0.08);\n    border-top-color: rgba(76,175,80,0.18);\n}\n.torrent-recommend-panel--recommended .torrent-recommend-panel__label{\n    color: rgba(160,255,200,0.92);\n}\n\n/* –ê–Ω—ñ–º–∞—Ü—ñ—è (–¥—É–∂–µ –º—è–∫–∞) */\n.torrent-recommend-panel{\n    animation: tr-panel-in 0.22s ease-out;\n}\n@keyframes tr-panel-in{\n    from{ opacity: 0; transform: translateY(-3px); }\n    to{ opacity: 1; transform: translateY(0); }\n}\n\n/* –ü—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –ø—Ä–∏ —Ñ–æ–∫—É—Å—ñ –∫–∞—Ä—Ç–∫–∏ */\n.torrent-item.focus .torrent-recommend-panel{\n    background: rgba(255,255,255,0.08);\n    border-top-color: rgba(255,255,255,0.16);\n}\n\n/* –ö–æ–º–ø–∞–∫—Ç: –≤—É–∑—å–∫—ñ –µ–∫—Ä–∞–Ω–∏ - —Ö–æ–≤–∞—î–º–æ –º–µ—Ç—É, –∑–∞–ª–∏—à–∞—î–º–æ —á—ñ–ø—Å–∏ */\n@media (max-width: 520px){\n    .torrent-recommend-panel{\n        gap: 0.7em;\n        padding: 0.65em 0.9em 0.75em;\n    }\n    .torrent-recommend-panel__meta{\n        display: none;\n    }\n}\n',document.head.appendChild(e)}(),se(),setTimeout((()=>{S()}),1200),window.Lampa&&window.Lampa.Parser?oe():setTimeout((()=>{oe()}),1e3),Lampa.Listener.follow("torrent",(e=>{"render"===e.type&&re(e)})),Lampa.Listener.follow("activity",(e=>{"start"===e.type&&"torrents"===e.component&&console.log("[EasyTorrent] –ù–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Ç–æ—Ä—Ä–µ–Ω—Ç—ñ–≤")})),console.log("[EasyTorrent] –ì–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏!")}Y.forEach((e=>{Q.set(e.id,e),Z.set(String(e.name||"").toLowerCase(),e.id),W.add(e.name)})),window.appready?ae():Lampa.Listener.follow("app",(e=>{"ready"===e.type&&ae()}))}();