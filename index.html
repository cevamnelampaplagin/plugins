<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–π—Å—Ç–µ—Ä –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Lampa - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —Ç–æ—Ä–µ–Ω—Ç—ñ–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.1/Sortable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.3);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }

        .content {
            padding: 40px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 1.8em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .step-description {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .question {
            margin-bottom: 35px;
        }

        .question-label {
            font-weight: 600;
            margin-bottom: 15px;
            display: block;
            font-size: 1.1em;
            color: #444;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(5px);
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option-content {
            flex: 1;
        }

        .option-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #333;
        }

        .option-desc {
            font-size: 0.9em;
            color: #777;
        }

        .option input:checked ~ .option-content {
            color: #667eea;
        }

        .slider-container {
            margin: 20px 0;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
            border: none;
        }

        .slider-value {
            text-align: center;
            font-weight: 600;
            color: #667eea;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .priority-list {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
        }

        .priority-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: move;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            user-select: none;
        }

        .priority-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .sortable-ghost {
            opacity: 0.4;
            background: #f0f0f0;
        }

        .sortable-chosen {
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            border: 2px solid #667eea;
        }

        .sortable-drag {
            opacity: 1;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        .priority-number {
            width: 35px;
            height: 35px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.1em;
        }

        .priority-name {
            flex: 1;
            font-weight: 600;
            color: #333;
        }

        .drag-handle {
            color: #999;
            cursor: move;
            padding: 5px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        button {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .result-container {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 30px;
        }

        .config-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .copy-button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .copy-button:active {
            transform: translateY(0);
        }

        .hint {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            color: #856404;
            font-size: 0.95em;
        }

        .hint strong {
            display: block;
            margin-bottom: 5px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        .input-group input[type="number"],
        .input-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .emoji {
            font-size: 1.3em;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ –ú–∞—Å—Ç–µ—Ä –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π</h1>
            <p>–î–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ñ—ñ–≥—É</p>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="content">
            <!-- –®–∞–≥ 1: –Ø–∫—ñ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
            <div class="step active" data-step="1">
                <h2 class="step-title"><span class="emoji">üé¨</span>–ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</h2>
                <p class="step-description">–í–∏–±–µ—Ä—ñ—Ç—å —è–∫—ñ—Å—Ç—å, –≤ —è–∫—ñ–π –∑–∞–∑–≤–∏—á–∞–π –¥–∏–≤–∏—Ç–µ—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç</p>
                
                <div class="question">
                    <label class="question-label">–í —è–∫—ñ–π —è–∫–æ—Å—Ç—ñ –¥–∏–≤–∏—Ç–µ—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç?</label>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="device_type" value="tv_4k">
                            <div class="option-content">
                                <div class="option-title">üé¨ 4K Ultra HD (2160p)</div>
                                <div class="option-desc">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —è–∫—ñ—Å—Ç—å –¥–ª—è —Å—É—á–∞—Å–Ω–∏—Ö –µ–∫—Ä–∞–Ω—ñ–≤</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="radio" name="device_type" value="tv_fhd">
                            <div class="option-content">
                                <div class="option-title">üì∫ Full HD (1080p)</div>
                                <div class="option-desc">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –≤–∏—Å–æ–∫–∞ —è–∫—ñ—Å—Ç—å</div>
                            </div>
                        </label>
                        <!-- –†–µ–∑–µ—Ä–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ (–∑–∞–ª–∏—à–µ–Ω—ñ –≤ –∫–æ–¥—ñ, –∞–ª–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ):
                        <label class="option">
                            <input type="radio" name="device_type" value="pc_4k">
                            <div class="option-content">
                                <div class="option-title">üíª –ü–ö –∑ 4K –º–æ–Ω—ñ—Ç–æ—Ä–æ–º</div>
                                <div class="option-desc">–ö–æ–º–ø'—é—Ç–µ—Ä –∑ –º–æ–Ω—ñ—Ç–æ—Ä–æ–º 2160p –∏ –≤–∏—â–µ</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="radio" name="device_type" value="pc_fhd">
                            <div class="option-content">
                                <div class="option-title">üíª –ü–ö –∑ Full HD –º–æ–Ω—ñ—Ç–æ—Ä–æ–º</div>
                                <div class="option-desc">–ö–æ–º–ø'—é—Ç–µ—Ä –∑ –º–æ–Ω—ñ—Ç–æ—Ä–æ–º 1080p</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="radio" name="device_type" value="mobile">
                            <div class="option-content">
                                <div class="option-title">üì± –ú–æ–±—ñ–ª—å–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π</div>
                                <div class="option-desc">–°–º–∞—Ä—Ç—Ñ–æ–Ω –∞–±–æ –ø–ª–∞–Ω—à–µ—Ç</div>
                            </div>
                        </label>
                        -->
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 2: –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó -->
            <div class="step" data-step="2">
                <h2 class="step-title"><span class="emoji">üé®</span>–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó</h2>
                <p class="step-description">–ü–æ–∑–Ω–∞—á—Ç–µ –≤—Å—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó, —è–∫—ñ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π</p>
                
                <div class="question">
                    <label class="question-label">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ HDR</label>
                    <div class="hint">
                        <strong>–ü—ñ–¥–∫–∞–∑–∫–∞:</strong>
                        –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–ª–µ–≤—ñ–∑–æ—Ä–∞ –∞–±–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∞
                    </div>
                    <div class="checkbox-group">
                        <label class="option">
                            <input type="checkbox" name="tech_hdr" value="hdr10">
                            <div class="option-content">
                                <div class="option-title">HDR10</div>
                                <div class="option-desc">–ë–∞–∑–æ–≤–∏–π HDR</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="tech_hdr" value="hdr10plus">
                            <div class="option-content">
                                <div class="option-title">HDR10+</div>
                                <div class="option-desc">–î–∏–Ω–∞–º—ñ—á–Ω–∏–π HDR</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="tech_hdr" value="dolby_vision">
                            <div class="option-content">
                                <div class="option-title">Dolby Vision</div>
                                <div class="option-desc">–ü—Ä–µ–º—ñ—É–º HDR</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="question">
                    <label class="question-label">–ó–≤—É–∫–æ–≤—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó</label>
                    <div class="checkbox-group">
                        <label class="option">
                            <input type="checkbox" name="tech_audio" value="surround_51">
                            <div class="option-content">
                                <div class="option-title">5.1 Surround</div>
                                <div class="option-desc">–û–±'—î–º–Ω–∏–π –∑–≤—É–∫</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="tech_audio" value="surround_71">
                            <div class="option-content">
                                <div class="option-title">7.1 Surround</div>
                                <div class="option-desc">–†–æ–∑—à–∏—Ä–µ–Ω–∏–π –æ–±'—î–º–Ω–∏–π –∑–≤—É–∫</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="tech_audio" value="dolby_atmos">
                            <div class="option-content">
                                <div class="option-title">Dolby Atmos</div>
                                <div class="option-desc">3D –∑–≤—É–∫</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 3: –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç -->
            <div class="step" data-step="3">
                <h2 class="step-title"><span class="emoji">üåê</span>–®–≤–∏–¥–∫—ñ—Å—Ç—å —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É</h2>
                <p class="step-description">–¶–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É –≤–∏—Å–æ–∫–æ—ó —è–∫–æ—Å—Ç—ñ</p>
                
                <div class="question">
                    <label class="question-label">–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤–∞—à–æ–≥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑'—î–¥–Ω–∞–Ω–Ω—è</label>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="internet_speed" value="slow">
                            <div class="option-content">
                                <div class="option-title">üêå –ü–æ–≤—ñ–ª—å–Ω–µ (–¥–æ 10 –ú–±—ñ—Ç/—Å)</div>
                                <div class="option-desc">–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è HD –∏ –Ω–∏–∂—á–µ</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="radio" name="internet_speed" value="medium">
                            <div class="option-content">
                                <div class="option-title">üöó –°—Ä–µ–¥–Ω—î (10-50 –ú–±—ñ—Ç/—Å)</div>
                                <div class="option-desc">–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è Full HD</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="radio" name="internet_speed" value="fast">
                            <div class="option-content">
                                <div class="option-title">üöÄ –®–≤–∏–¥–∫–µ (50-100 –ú–±—ñ—Ç/—Å)</div>
                                <div class="option-desc">–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è 4K</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="radio" name="internet_speed" value="very_fast">
                            <div class="option-content">
                                <div class="option-title">‚ö° –î—É–∂–µ —à–≤–∏–¥–∫–µ (100+ –ú–±—ñ—Ç/—Å)</div>
                                <div class="option-desc">–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –±—É–¥—å-—è–∫–æ—ó —è–∫–æ—Å—Ç—ñ</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="question">
                    <label class="question-label">–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –∑'—î–¥–Ω–∞–Ω–Ω—è</label>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="internet_stability" value="unstable">
                            <div class="option-content">
                                <div class="option-title">–ù–µ —Å—Ç–∞–±—ñ–ª—å–Ω–æ</div>
                                <div class="option-desc">–ß–∞—Å—Ç—ñ –æ–±—Ä–∏–≤–∏, —Å–∫–∞—á–∫–∏ —à–≤–∏–¥–∫–æ—Å—Ç—ñ</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="radio" name="internet_stability" value="stable">
                            <div class="option-content">
                                <div class="option-title">–°—Ç–∞–±—ñ–ª—å–Ω–µ</div>
                                <div class="option-desc">–ü–æ—Å—Ç—ñ–π–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å –±–µ–∑ –ø—Ä–æ—Å–∞–¥–æ–∫</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 4: –ú–æ–≤–∏ –∞—É–¥–∏–æ -->
            <div class="step" data-step="4">
                <h2 class="step-title"><span class="emoji">üó£Ô∏è</span>–ú–æ–≤–∏ –æ–∑–≤—É—á–∫–∏</h2>
                <p class="step-description">–í–∏–±–µ—Ä—ñ—Ç—å –º–æ–≤–∏ –∞—É–¥—ñ–æ, —è–∫—ñ –≤–∏ –±–∞–∂–∞—î—Ç–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è—Ö</p>

                <div class="question">
                    <label class="question-label">–Ø–∫—ñ –º–æ–≤–∏ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω—ñ?</label>
                    <div class="checkbox-group">
                        <label class="option">
                            <input type="checkbox" name="preferred_languages" value="rus" checked>
                            <div class="option-content">
                                <div class="option-title">üñï –û–∫—É–ø–∞–Ω—Ç—Å—å–∫–∞</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="preferred_languages" value="ukr">
                            <div class="option-content">
                                <div class="option-title">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</div>
                            </div>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="preferred_languages" value="eng" checked>
                            <div class="option-content">
                                <div class="option-title">üá¨üáß –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 5: –í–∏–±—ñ—Ä –æ–∑–≤—É—á–æ–∫ -->
            <div class="step" data-step="5">
                <h2 class="step-title"><span class="emoji">üéß</span>–í–∞—à—ñ –æ–∑–≤—É—á–∫–∏</h2>
                <p class="step-description">–ü–æ–∑–Ω–∞—á—Ç–µ –æ–∑–≤—É—á–∫–∏, —è–∫—ñ –≤–∏ –∑–Ω–∞—î—Ç–µ —á–∏ –≤—ñ–¥–¥–∞—î—Ç–µ –ø–µ—Ä–µ–≤–∞–≥—É. –¢—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –ø–æ—Ç—Ä–∞–ø–ª—è—Ç—å –¥–æ —Å–ø–∏—Å–∫—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤.</p>
                
                <div class="input-group" style="margin-bottom: 20px;">
                    <input type="text" id="voiceSearch" placeholder="üîç –ü–æ–∏—Å–∫ –æ–∑–≤—É—á–∫–∏..." style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;" oninput="filterVoices()">
                </div>

                <div class="input-group" style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="toggleAllVoices(true)" style="padding: 8px; flex: none;">–í—ñ–¥–º—ñ—Ç–∏—Ç–∏ –≤—Å–µ</button>
                    <button class="btn-secondary" onclick="toggleAllVoices(false)" style="padding: 8px; flex: none;">–ó–Ω—è—Ç–∏ –≤—Å–µ</button>
                </div>

                <div class="checkbox-group" id="voiceSelectionGroup" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <!-- –ë—É–¥–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </div>
            </div>

            <!-- –®–∞–≥ 6: –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –æ–∑–≤—É—á–æ–∫ -->
            <div class="step" data-step="6">
                <h2 class="step-title"><span class="emoji">üéôÔ∏è</span>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –æ–∑–≤—É—á–æ–∫</h2>
                <p class="step-description">–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –≤–∏–±—Ä–∞–Ω—ñ –æ–∑–≤—É—á–∫–∏ –≤ –ø–æ—Ä—è–¥–∫—É –ø–µ—Ä–µ–≤–∞–≥–∏ (–∑–≥–æ—Ä–∏ - –Ω–∞–π—É–ª—é–±–ª–µ–Ω—ñ—à–∞)</p>
                
                <div class="hint">
                    <strong>–°–æ–≤–µ—Ç:</strong> –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –µ–ª–µ–º–µ–Ω—Ç–∏, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç.
                </div>

                <div class="priority-list" id="audioTrackPriority">
                    <!-- –ë—É–¥–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º –Ω–∞ –æ—Å–Ω–æ–≤—ñ –®–∞–≥–∞ 5 -->
                </div>
            </div>

            <!-- –®–∞–≥ 7: –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å-->
            <div class="step" data-step="7">
                <h2 class="step-title"><span class="emoji">‚öñÔ∏è</span>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤</h2>
                <p class="step-description">–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ –ø–æ—Ä—è–¥–∫—É –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ (–∑–≤–µ—Ä—Ö—É ‚Äì –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏–π)</p>
                
                <div class="hint">
                    <strong>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:</strong>
                    –°–∏—Å—Ç–µ–º–∞ –≤–∏–±–∏—Ä–∞—Ç–∏–º–µ —Ç–æ—Ä–µ–Ω—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É –∑–∞ –≤–µ—Ä—Ö–Ω—ñ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º, –ø–æ—Ç—ñ–º –∑–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —ñ —Ç.–¥.
                </div>

                <div class="priority-list" id="parameterPriority">
                    <div class="priority-item" data-value="audio_track">
                        <div class="priority-number">1</div>
                        <div class="priority-name">üéôÔ∏è –û–∑–≤—É—á–∫–∞</div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="priority-item" data-value="resolution">
                        <div class="priority-number">2</div>
                        <div class="priority-name">üé¨ –†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –≤—ñ–¥–µ–æ (4K, FHD, HD)</div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="priority-item" data-value="availability">
                        <div class="priority-number">3</div>
                        <div class="priority-name">‚ö° –î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å (—Å—ñ–¥–∏/–ø—ñ—Ä–∏)</div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="priority-item" data-value="bitrate">
                        <div class="priority-number">4</div>
                        <div class="priority-name">üìä –ë—ñ—Ç—Ä–µ–π—Ç (—è–∫—ñ—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏)</div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="priority-item" data-value="hdr">
                        <div class="priority-number">5</div>
                        <div class="priority-name">üåà HDR/Dolby Vision</div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="priority-item" data-value="audio_quality">
                        <div class="priority-number">6</div>
                        <div class="priority-name">üîä –Ø–∫—ñ—Å—Ç—å –∑–≤—É–∫–∞ (Atmos, 7.1, 5.1)</div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 8: –î–æ–¥–∞—Ç–∫–æ–≤–æ -->
            <div class="step" data-step="8">
                <h2 class="step-title"><span class="emoji">‚öôÔ∏è</span>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
                <p class="step-description">–§—ñ–Ω–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏</p>
                
                <div class="question">
                    <label class="question-label">–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—ñ–¥—ñ–≤ –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</label>
                    <div class="input-group">
                        <input type="number" id="min_seeds" min="0" max="100" value="3">
                    </div>
                </div>

                <div class="question">
                    <label class="question-label">–°–∫—ñ–ª—å–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏?</label>
                    <div class="input-group">
                        <input type="number" id="recommendation_count" min="1" max="10" value="5">
                    </div>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
            <div class="step" data-step="9">
                <h2 class="step-title"><span class="emoji">‚úÖ</span>–í–∞—à —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π –≥–æ—Ç–æ–≤–∏–π!</h2>
                <p class="step-description">–°–∫–æ–ø—ñ—é–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥ —ñ –≤—Å—Ç–∞–≤—Ç–µ –π–æ–≥–æ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –õ–∞–º–ø–∏</p>
                
                <div class="result-container">
                    <div class="config-output" id="configOutput"></div>
                    <button class="copy-button" onclick="copyConfig()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥</button>
                </div>

                <div class="hint">
                    <strong>–Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:</strong>
                    1. –ö–æ–Ω—Ñ—ñ–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ –¢–í (—è–∫—â–æ –≤–∫–∞–∑–∞–Ω–æ –∫–æ–¥ —Å–ø–æ–ª—É—á–µ–Ω–Ω—è)<br>
                    2. –ê–±–æ —Å–∫–æ–ø—ñ—é–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥ –≤—Ä—É—á–Ω—É:<br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ –í—ñ–¥–∫—Ä–∏–π—Ç–µ <strong>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –õ–∞–º–ø–∏</strong><br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ –†–æ–∑–¥—ñ–ª <strong>EasyTorrent</strong><br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ –ü—É–Ω–∫—Ç <strong>–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (JSON)</strong><br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ –í—Å—Ç–∞–≤—Ç–µ —Ç–µ–∫—Å—Ç —ñ –Ω–∞–∂–º—ñ—Ç—å OK<br>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-secondary" id="prevBtn" onclick="prevStep()" style="display: none;">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="btn-primary" id="nextBtn" onclick="nextStep()">–î–∞–ª—ñ ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SUPABASE CONFIG
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const SUPABASE_URL = 'https://xozswgtbcjorxzabawmk.supabase.co';
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvenN3Z3RiY2pvcnh6YWJhd21rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyODAzODksImV4cCI6MjA4Njg1NjM4OX0.ajYvu0KecRKZGLge_682oU5MD-WiQSM2jNZwuGHw2Uo';

        let currentStep = 1;
        const totalSteps = 9;
        let pairCode = null;

        // –û–∑–≤—É—á–∫–∏ –≤ –≤–∏–≥–ª—è–¥—ñ —á–∏—Å–ª–æ–≤–∏—Ö id (–º–∞—é—Ç—å —Å–ø—ñ–≤–ø–∞–¥–∞—Ç—å –∑ EasyTorrent –ø–ª–∞–≥—ñ–Ω–æ–º)
        const AUDIO_TRACKS = [
            { id: 0,  name: '–î—É–±–ª—è–∂ RU', languages: ['rus'] },
            { id: 1,  name: '–î—É–±–ª—è–∂ UKR', languages: ['ukr'] }, // üá∫üá¶
            { id: 2,  name: '–î—É–±–ª—è–∂ –ü–∏—Ñ–∞–≥–æ—Ä', languages: ['rus'] },
            { id: 3,  name: '–î—É–±–ª—è–∂ Red Head Sound', languages: ['rus'] },
            { id: 4,  name: '–î—É–±–ª—è–∂ Videofilm', languages: ['rus'] },
            { id: 5,  name: '–î—É–±–ª—è–∂ MovieDalen', languages: ['rus'] },
            { id: 6,  name: '–î—É–±–ª—è–∂ LeDoyen', languages: ['rus'] },
            { id: 7,  name: '–î—É–±–ª—è–∂ Whiskey Sound', languages: ['rus'] },
            { id: 8,  name: '–î—É–±–ª—è–∂ IRON VOICE', languages: ['rus'] },
            { id: 9,  name: '–î—É–±–ª—è–∂ AlexFilm', languages: ['rus'] },
            { id: 10, name: '–î—É–±–ª—è–∂ Amedia', languages: ['rus'] },
            { id: 11, name: 'MVO HDRezka', languages: ['rus', 'ukr'] }, // –¥–≤—É–º–æ–≤–Ω–∞ —Å—Ç—É–¥—ñ—èüá∫üá¶
            { id: 12, name: 'MVO LostFilm', languages: ['rus'] },
            { id: 13, name: 'MVO TVShows', languages: ['rus'] },
            { id: 14, name: 'MVO Jaskier', languages: ['rus'] },
            { id: 15, name: 'MVO RuDub', languages: ['rus'] },
            { id: 16, name: 'MVO LE-Production', languages: ['rus'] },
            { id: 17, name: 'MVO –ö—É–±–∏–∫ –≤ –ö—É–±–µ', languages: ['rus'] },
            { id: 18, name: 'MVO NewStudio', languages: ['rus'] },
            { id: 19, name: 'MVO Good People', languages: ['rus'] },
            { id: 20, name: 'MVO IdeaFilm', languages: ['rus'] },
            { id: 21, name: 'MVO AMS', languages: ['rus'] },
            { id: 22, name: 'MVO Baibako', languages: ['rus'] },
            { id: 23, name: 'MVO Profix Media', languages: ['rus'] },
            { id: 24, name: 'MVO NewComers', languages: ['rus'] },
            { id: 25, name: 'MVO GoLTFilm', languages: ['rus'] },
            { id: 26, name: 'MVO JimmyJ', languages: ['rus'] },
            { id: 27, name: 'MVO Kerob', languages: ['rus'] },
            { id: 28, name: 'MVO LakeFilms', languages: ['rus'] },
            { id: 29, name: 'MVO Twister', languages: ['rus'] },
            { id: 30, name: 'MVO Voice Project', languages: ['rus'] },
            { id: 31, name: 'MVO Dragon Money Studio', languages: ['rus'] },
            { id: 32, name: 'MVO Syncmer', languages: ['rus'] },
            { id: 33, name: 'MVO ColdFilm', languages: ['rus'] },
            { id: 34, name: 'MVO SunshineStudio', languages: ['rus'] },
            { id: 35, name: 'MVO Ultradox', languages: ['rus'] },
            { id: 36, name: 'MVO Octopus', languages: ['rus'] },
            { id: 37, name: 'MVO OMSKBIRD', languages: ['rus'] },
            { id: 38, name: 'AVO –í–æ–ª–æ–¥–∞—Ä—Å–∫–∏–π', languages: ['rus'] },
            { id: 39, name: 'AVO –Ø—Ä–æ—Ü–∫–∏–π', languages: ['rus'] },
            { id: 40, name: 'AVO –°–µ—Ä–±–∏–Ω', languages: ['rus'] },
            { id: 41, name: 'PRO Gears Media', languages: ['rus'] },
            { id: 42, name: 'PRO Hamsterstudio', languages: ['rus'] },
            { id: 43, name: 'PRO P.S.Energy', languages: ['rus'] },
            { id: 44, name: 'UKR –ù–µ–ó—É–ø–∏–Ω—è–π–ü—Ä–æ–¥–∞–∫—à–Ω', languages: ['ukr'] }, // üá∫üá¶
            { id: 45, name: 'Original', languages: ['eng'] }
        ];

        const AUDIO_TRACK_BY_ID = new Map(AUDIO_TRACKS.map(t => [t.id, t]));
        const DEFAULT_SELECTED_VOICE_IDS = [2, 5, 6, 3, 4, 0, 11, 12, 13, 14, 15, 16, 17, 18, 31, 32, 45];
        let selectedVoiceIds = new Set(DEFAULT_SELECTED_VOICE_IDS);

        // –Ü–Ω—ñ—Ü–∏–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', function() {
            checkPairCode();
            bindLanguageSelection();
            renderVoiceSelection();
            updateProgress();
            initSortableParameters();
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PAIR CODE MANAGEMENT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function checkPairCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('pairCode');
            
            if (code && /^[A-Za-z0-9]{6}$/.test(code)) {
                pairCode = code.toUpperCase();
                console.log('[EasyTorrent] Pair code detected:', pairCode);
            } else {
                showPairCodeDialog();
            }
        }

        function showPairCodeDialog() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 500px;
                    text-align: center;
                ">
                    <h2 style="color: #667eea; margin-bottom: 20px;">üîó –ö–æ–¥ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</h2>
                    <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                        –í–≤–µ–¥—ñ—Ç—å 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —ñ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å Lampa<br>
                        (—Ü–∏—Ñ—Ä–∏ —ñ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ –±—É–∫–≤–∏)
                    </p>
                    <input 
                        type="text" 
                        id="pairCodeInput" 
                        placeholder="ABC123" 
                        maxlength="6"
                        style="
                            width: 100%;
                            padding: 15px;
                            font-size: 1.5em;
                            text-align: center;
                            text-transform: uppercase;
                            border: 2px solid #e0e0e0;
                            border-radius: 12px;
                            margin-bottom: 20px;
                            letter-spacing: 0.3em;
                            font-weight: bold;
                        "
                    />
                    <div style="display: flex; gap: 15px;">
                        <button 
                            onclick="skipPairCode()"
                            style="
                                flex: 1;
                                padding: 15px;
                                background: #e0e0e0;
                                color: #666;
                                border: none;
                                border-radius: 12px;
                                font-size: 1em;
                                font-weight: 600;
                                cursor: pointer;
                            "
                        >–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
                        <button 
                            onclick="confirmPairCode()"
                            style="
                                flex: 1;
                                padding: 15px;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                color: white;
                                border: none;
                                border-radius: 12px;
                                font-size: 1em;
                                font-weight: 600;
                                cursor: pointer;
                            "
                        >–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('pairCodeInput').focus();
            
            // Enter –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
            document.getElementById('pairCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') confirmPairCode();
            });
            
            window.pairCodeModal = modal;
        }

        function confirmPairCode() {
            const input = document.getElementById('pairCodeInput');
            const code = input.value.toUpperCase().trim();
            
            if (!/^[A-Z0-9]{6}$/.test(code)) {
                alert('–ö–æ–¥ –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ —Ä—ñ–≤–Ω–æ 6 —Å–∏–º–≤–æ–ª—ñ–≤ (–ª—ñ—Ç–µ—Ä–∏ —Ç–∞ —Ü–∏—Ñ—Ä–∏)');
                return;
            }
            
            pairCode = code;
            console.log('[EasyTorrent] Pair code set:', pairCode);
            
            if (window.pairCodeModal) {
                document.body.removeChild(window.pairCodeModal);
                window.pairCodeModal = null;
            }
        }

        function skipPairCode() {
            pairCode = null;
            console.log('[EasyTorrent] Pair code skipped');
            
            if (window.pairCodeModal) {
                document.body.removeChild(window.pairCodeModal);
                window.pairCodeModal = null;
            }
        }

        function getSelectedLanguages() {
            return new Set(getCheckboxValues('preferred_languages'));
        }

        function bindLanguageSelection() {
            document.querySelectorAll('input[name="preferred_languages"]').forEach(cb => {
                cb.addEventListener('change', () => {
                    // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –Ω–∞ –∫—Ä–æ—Ü—ñ –≤–∏–±–æ—Ä—É –æ–∑–≤—É—á–æ–∫ ‚Äì –ø–µ—Ä–µ–º–∞–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫
                    if (currentStep === 5) {
                        renderVoiceSelection(true);
                    }
                });
            });
        }

        function renderVoiceSelection() {
            const group = document.getElementById('voiceSelectionGroup');
            const allowed = getSelectedLanguages();
            group.innerHTML = '';

            AUDIO_TRACKS
                .filter(v => v.languages.some(l => allowed.has(l)))
                .forEach(v => {
                const checked = selectedVoiceIds.has(v.id) ? 'checked' : '';
                const label = document.createElement('label');
                label.className = 'option';
                label.innerHTML = `
                    <input type="checkbox" name="selected_voices" value="${v.id}" ${checked}>
                    <div class="option-content">
                        <div class="option-title" style="font-size: 0.9em;">${v.name}</div>
                    </div>
                `;
                group.appendChild(label);
            });

            // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–º Set –ø—Ä–∏ –∫–ª—ñ–∫–∞—Ö
            document.querySelectorAll('input[name="selected_voices"]').forEach(cb => {
                cb.addEventListener('change', () => {
                    const id = parseInt(cb.value, 10);
                    if (!Number.isFinite(id)) return;
                    if (cb.checked) selectedVoiceIds.add(id);
                    else selectedVoiceIds.delete(id);
                });
            });
        }

        function toggleAllVoices(state) {
            const searchValue = document.getElementById('voiceSearch').value.toLowerCase();
            document.querySelectorAll('input[name="selected_voices"]').forEach(cb => {
                const label = cb.closest('label');
                // –ü—Ä–∏–º—ñ–Ω—è–µ–º —Ç—ñ–ª—å–∫–∏ –¥–æ –≤–∏–¥–∏–º–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
                if (!searchValue || label.style.display !== 'none') {
                    cb.checked = state;
                    const id = parseInt(cb.value, 10);
                    if (Number.isFinite(id)) {
                        if (state) selectedVoiceIds.add(id);
                        else selectedVoiceIds.delete(id);
                    }
                }
            });
        }

        function filterVoices() {
            const searchValue = document.getElementById('voiceSearch').value.toLowerCase();
            const labels = document.querySelectorAll('#voiceSelectionGroup label');
            
            labels.forEach(label => {
                const text = label.textContent.toLowerCase();
                if (text.includes(searchValue)) {
                    label.style.display = '';
                } else {
                    label.style.display = 'none';
                }
            });
        }

        function renderVoicePriorityList() {
            const container = document.getElementById('audioTrackPriority');
            container.innerHTML = '';
            
            // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –≤–∏–±—Ä–∞–Ω—ñ –æ–∑–≤—É—á–∫–∏
            const selectedSet = new Set(
                Array.from(document.querySelectorAll('input[name="selected_voices"]:checked'))
                    .map(cb => parseInt(cb.value, 10))
                    .filter(n => Number.isFinite(n))
            );
            
            // –§–æ—Ä–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É:
            // 1. –°–ø–æ—á–∞—Ç–∫—É –±–µ—Ä–µ–º –æ–∑–≤—É—á–∫–∏ —ñ–∑ DEFAULT_SELECTED_VOICE_IDS (–≤ —Ç–æ–º—É –ø–æ—Ä—è–¥–∫—É)
            // 2. –ü–æ—Ç—ñ–º –¥–æ–±–∞–≤–ª—è—î–º —ñ–Ω—à—ñ –≤–∏–±—Ä–∞–Ω—ñ –æ–∑–≤—É—á–∫–∏
            const ordered = [];
            
            DEFAULT_SELECTED_VOICE_IDS.forEach(id => {
                if (selectedSet.has(id)) {
                    ordered.push(id);
                    selectedSet.delete(id);
                }
            });
            
            // –î–æ–¥–∞—î–º–æ —ñ–Ω—à—ñ –æ—Å—Ç–∞–≤—à –≤–∏–±—Ä–∞–Ω—ñ –æ–∑–≤—É—á–∫–∏
            selectedSet.forEach(id => {
                ordered.push(id);
            });
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫
            ordered.forEach((id, index) => {
                const itemName = AUDIO_TRACK_BY_ID.get(id) ? AUDIO_TRACK_BY_ID.get(id).name : String(id);
                const item = document.createElement('div');
                item.className = 'priority-item';
                item.dataset.value = String(id);
                item.innerHTML = `
                    <div class="priority-number">${index + 1}</div>
                    <div class="priority-name">${itemName}</div>
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                `;
                container.appendChild(item);
            });

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Sortable –¥–ª—è –æ–∑–≤—É—á–æ–∫
            initSortableVoices();
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è SortableJS –¥–ª—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ 
        function initSortableParameters() {
            const container = document.getElementById('parameterPriority');
            Sortable.create(container, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                dragClass: 'sortable-drag',
                handle: '.priority-item',
                onEnd: function() {
                    updatePriorityNumbers(container);
                }
            });
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è SortableJS –¥–ª—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∞ –æ–∑–≤—É—á–æ–∫
        function initSortableVoices() {
            const container = document.getElementById('audioTrackPriority');
            Sortable.create(container, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                dragClass: 'sortable-drag',
                handle: '.priority-item',
                onEnd: function() {
                    updatePriorityNumbers(container);
                }
            });
        }

        function updatePriorityNumbers(container) {
            const items = container.querySelectorAll('.priority-item');
            items.forEach((item, index) => {
                item.querySelector('.priority-number').textContent = index + 1;
            });
        }

        // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
        function nextStep() {
            // –®–∞–≥ 4: –º–æ–≤–∏
            if (currentStep === 4) {
                const langs = getCheckboxValues('preferred_languages');
                if (langs.length === 0) {
                    alert('–í—ã–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω—É –º–æ–≤—É');
                    return;
                }
                // –ü–µ—Ä–µ–¥ –∫—Ä–æ–∫–æ–º –≤–∏–±–æ—Ä—É –æ–∑–≤—É—á–æ–∫ –ø–µ—Ä–µ–º–∞–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —ñ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é
                renderVoiceSelection(true);
            }

            // –®–∞–≥ 5: –≤–∏–±—ñ—Ä –æ–∑–≤—É—á–æ–∫
            if (currentStep === 5) {
                const selected = document.querySelectorAll('input[name="selected_voices"]:checked');
                if (selected.length === 0) {
                    alert('–í—ã–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω—É –æ–∑–≤—É—á–∫—É');
                    return;
                }
                renderVoicePriorityList();
            }

            if (currentStep < totalSteps) {
                if (validateStep(currentStep)) {
                    currentStep++;
                    showStep(currentStep);
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î–º–æ –∫–æ–Ω—Ñ—ñ–≥ –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É –∫—Ä–æ—Ü—ñ
                    if (currentStep === totalSteps) {
                        generateConfig();
                    }
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function showStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.querySelector(`.step[data-step="${step}"]`).classList.add('active');

            document.getElementById('prevBtn').style.display = step === 1 ? 'none' : 'block';
            
            // –ù–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É –∫—Ä–æ—Ü—ñ –ø—Ä–∏—Ö–æ–≤—É—î–º –∫–Ω–æ–ø–∫—É "–î–∞–ª—ñ"
            if (step === totalSteps) {
                document.getElementById('nextBtn').style.display = 'none';
            } else {
                document.getElementById('nextBtn').style.display = 'block';
                document.getElementById('nextBtn').textContent = '–î–∞–ª—ñ ‚Üí';
            }

            updateProgress();
        }

        function updateProgress() {
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function validateStep(step) {
            const currentStepEl = document.querySelector(`.step[data-step="${step}"]`);
            if (!currentStepEl) return true;
            const requiredRadios = currentStepEl.querySelectorAll('input[type="radio"]');
            
            if (requiredRadios.length > 0) {
                const radioGroups = {};
                requiredRadios.forEach(radio => {
                    if (!radioGroups[radio.name]) radioGroups[radio.name] = false;
                    if (radio.checked) radioGroups[radio.name] = true;
                });
                for (let group in radioGroups) {
                    if (!radioGroups[group]) {
                        alert('–ë—É–¥—å-–ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç');
                        return false;
                    }
                }
            }
            return true;
        }

        function getParameterPriority() {
            const items = document.querySelectorAll('#parameterPriority .priority-item');
            return Array.from(items).map(item => item.dataset.value);
        }

        function getAudioTrackPriority() {
            const items = document.querySelectorAll('#audioTrackPriority .priority-item');
            return Array.from(items)
                .map(item => parseInt(item.dataset.value, 10))
                .filter(n => Number.isFinite(n));
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É
        function generateConfig() {
            const config = {
                version: "2.1",
                generated: new Date().toISOString(),
                device: {
                    type: getRadioValue('device_type'),
                    supported_hdr: getCheckboxValues('tech_hdr'),
                    // –°—Ç–µ—Ä–µ–æ (2.0) –≤–≤–∞–∂–∞—î–º–æ –±–∞–∑–æ–≤–∏–º —ñ –Ω–µ –ø–∏—Ç–∞—î–º–æ –æ–∫—Ä–µ–º–æ
                    supported_audio: Array.from(new Set([...getCheckboxValues('tech_audio'), 'stereo']))
                },
                network: {
                    speed: getRadioValue('internet_speed'),
                    stability: getRadioValue('internet_stability')
                },
                parameter_priority: getParameterPriority(),
                audio_track_priority: getAudioTrackPriority(),
                preferences: {
                    min_seeds: parseInt(document.getElementById('min_seeds').value),
                    recommendation_count: parseInt(document.getElementById('recommendation_count').value),
                    languages: getCheckboxValues('preferred_languages')
                },
                scoring_rules: generateScoringRules()
            };
            displayConfig(config);
            
            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ–Ω—Ñ—ñ–≥, —è–∫—â–æ —î pairCode
            if (pairCode) {
                sendConfigToSupabase(config);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SUPABASE API
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function sendConfigToSupabase(configObj) {
            try {
                const expiresAt = new Date(Date.now() + 5 * 60 * 1000).toISOString();
                
                const payload = [{
                    id: pairCode,
                    data: configObj,
                    expires_at: expiresAt
                }];
                
                showStatus('‚è≥ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó...', 'info');
                
                console.log('[EasyTorrent] Sending to Supabase:', {
                    url: `${SUPABASE_URL}/rest/v1/tv_configs`,
                    pairCode: pairCode,
                    payloadSize: JSON.stringify(payload).length
                });
                
                const res = await fetch(`${SUPABASE_URL}/rest/v1/tv_configs`, {
                    method: 'POST',
                    mode: 'cors',
                    credentials: 'omit',
                    headers: {
                        'apikey': ANON_KEY,
                        'Authorization': `Bearer ${ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'resolution=merge-duplicates,return=minimal'
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('[EasyTorrent] Response status:', res.status);
                
                if (!res.ok) {
                    const text = await res.text();
                    console.error('[EasyTorrent] Response error:', text);
                    throw new Error(`HTTP ${res.status}: ${text || res.statusText}`);
                }
                
                console.log('[EasyTorrent] Config sent successfully');
                showStatus('‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –¢–í!', 'success');
            } catch (error) {
                console.error('[EasyTorrent] Send error:', error);
                
                // –ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
                let errorMessage = error.message;
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorMessage = 'CORS –ø–æ–º–∏–ª–∫–∞ –∞–±–æ –º–µ—Ä–µ–∂–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase.';
                }
                
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${errorMessage}`, 'error');
            }
        }

        function showStatus(message, type) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            const oldStatus = document.getElementById('configStatus');
            if (oldStatus) oldStatus.remove();
            
            const status = document.createElement('div');
            status.id = 'configStatus';
            status.style.cssText = `
                margin-top: 20px;
                padding: 15px;
                border-radius: 8px;
                font-weight: 600;
                text-align: center;
                animation: fadeIn 0.3s ease;
            `;
            
            if (type === 'success') {
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                status.style.border = '2px solid #c3e6cb';
            } else if (type === 'error') {
                status.style.background = '#f8d7da';
                status.style.color = '#721c24';
                status.style.border = '2px solid #f5c6cb';
            } else {
                status.style.background = '#d1ecf1';
                status.style.color = '#0c5460';
                status.style.border = '2px solid #bee5eb';
            }
            
            status.textContent = message;
            
            const container = document.querySelector('.result-container');
            container.appendChild(status);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–±–∏—Ä–∞—î–º–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è —É—Å–ø—ñ—Ö—É
            if (type === 'success') {
                setTimeout(() => {
                    if (status.parentNode) {
                        status.style.opacity = '0';
                        status.style.transition = 'opacity 0.3s ease';
                        setTimeout(() => status.remove(), 300);
                    }
                }, 5000);
            }
        }

        function generateScoringRules() {
            const deviceType = getRadioValue('device_type');
            const internetSpeed = getRadioValue('internet_speed');
            const hdrSupport = getCheckboxValues('tech_hdr');
            const audioSupport = getCheckboxValues('tech_audio');
            const paramPriority = getParameterPriority();
            const priorityWeights = {};
            paramPriority.forEach((param, index) => {
                priorityWeights[param] = 100 - (index * 15);
            });

            const rules = {
                schema: "2.1",
                base_score: 100,
                weights: priorityWeights,
                resolution: { "2160": 0, "1440": 0, "1080": 0, "720": 0, "480": 0 },
                hdr: { "dolby_vision": 0, "hdr10plus": 0, "hdr10": 0, "sdr": 0 },
                bitrate_bonus: {
                    thresholds: [],
                    // bonus –≤ thresholds –±—É–¥–µ –≤–∂–µ "—Ñ—ñ–Ω–∞–ª—å–Ω–∏–º" (–≤–∑–≤–∞–∂–µ–Ω–∏–º), –±–µ–∑ –¥–æ–ø. –¥–æ–º–Ω–æ–∂–µ–Ω—è –≤ –ø–ª–∞–≥—ñ–Ω—ñ
                    missing_penalty: 0
                },
                availability: {
                    min_seeds: parseInt(document.getElementById('min_seeds').value),
                    below_min_penalty: 0,
                    log10_multiplier: 0
                },
                audio_track: {
                    curve: "linear",
                    max_points: 0
                },
                audio_quality: {
                    points: { dolby_atmos: 0, surround_71: 0, surround_51: 0, stereo: 0, unknown: 0 }
                },
                special_rules: []
            };

            const resWeight = priorityWeights['resolution'] / 100;
            if (deviceType.includes('4k')) {
                rules.resolution = { "2160": 100 * resWeight, "1440": 50 * resWeight, "1080": 20 * resWeight, "720": -30, "480": -60 };
            } else if (deviceType.includes('fhd')) {
                rules.resolution = { "2160": 40 * resWeight, "1440": 50 * resWeight, "1080": 100 * resWeight, "720": 10 * resWeight, "480": -40 };
            } else {
                rules.resolution = { "2160": 20 * resWeight, "1440": 40 * resWeight, "1080": 100 * resWeight, "720": 60 * resWeight, "480": 20 * resWeight };
            }

            const hdrWeight = priorityWeights['hdr'] / 100;
            if (hdrSupport.includes('dolby_vision')) {
                rules.hdr = { "dolby_vision": 100 * hdrWeight, "hdr10plus": 80 * hdrWeight, "hdr10": 80 * hdrWeight, "sdr": -40 * hdrWeight };
            } else if (hdrSupport.includes('hdr10plus') || hdrSupport.includes('hdr10')) {
                rules.hdr = { "dolby_vision": 60 * hdrWeight, "hdr10plus": 100 * hdrWeight, "hdr10": 100 * hdrWeight, "sdr": -35 * hdrWeight };
            } else {
                rules.hdr = { "dolby_vision": -20, "hdr10plus": -15, "hdr10": -15, "sdr": 0 };
            }

            // –ë—ñ—Ç—Ä–µ–π—Ç: –≥–µ–Ω–µ—Ä—É—î–º–æ –±–æ–Ω—É—Å–∏ —Ç–∞ —à—Ç—Ä–∞—Ñ–∏ –≤–∂–µ –∑–≤–∞–∂–µ–Ω–∏–º–∏ (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –¥–æ–º–Ω–æ–∂–µ–Ω–Ω—è —É –ø–ª–∞–≥—ñ–Ω—ñ)
            const bitrateWeight = priorityWeights['bitrate'] / 100;
            let baseThresholds = [];
            if (internetSpeed === 'slow') {
                baseThresholds = [{ min: 0, max: 5, bonus: 20 }, { min: 5, max: 10, bonus: 15 }, { min: 10, max: 20, bonus: 5 }, { min: 20, max: 999, bonus: -10 }];
            } else if (internetSpeed === 'medium') {
                baseThresholds = [{ min: 0, max: 5, bonus: 5 }, { min: 5, max: 15, bonus: 20 }, { min: 15, max: 30, bonus: 15 }, { min: 30, max: 999, bonus: 0 }];
            } else if (internetSpeed === 'fast') {
                baseThresholds = [{ min: 0, max: 10, bonus: 0 }, { min: 10, max: 20, bonus: 10 }, { min: 20, max: 40, bonus: 25 }, { min: 40, max: 999, bonus: 20 }];
            } else {
                baseThresholds = [{ min: 0, max: 15, bonus: 0 }, { min: 15, max: 30, bonus: 15 }, { min: 30, max: 60, bonus: 30 }, { min: 60, max: 999, bonus: 35 }];
            }
            rules.bitrate_bonus.thresholds = baseThresholds.map(t => ({ min: t.min, max: t.max, bonus: t.bonus * bitrateWeight }));

            // –®—Ç—Ä–∞—Ñ –∑–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö –±—ñ—Ç—Ä–µ–π—Ç—É (—Ä–∞–Ω—ñ—à–µ –∑–∞–ª–µ–∂–∞–≤ –≤—ñ–¥ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É bitrate)
            const bitrateIndex = paramPriority.indexOf('bitrate');
            const missingBase = (bitrateIndex === 0 ? -50 : (bitrateIndex === 1 ? -30 : -15));
            rules.bitrate_bonus.missing_penalty = missingBase * bitrateWeight;

            // –î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å/—Å—ñ–¥–∏: —à—Ç—Ä–∞—Ñ –Ω–∏–∂—á–µ –º—ñ–Ω—ñ–º—É–º–∞ —ñ –±–æ–Ω—É—Å –≤–∏—â–µ ‚Äî —Ç–æ–∂–µ –≥–µ–Ω–µ—Ä—É—î–º —è–∫ —Ñ—ñ–Ω–∞–ª—å–Ω—ñ —á–∏—Å–ª–∞
            const availWeight = priorityWeights['availability'] / 100;
            const availIndex = paramPriority.indexOf('availability');
            const belowBase = (availIndex === 0 ? -80 : (availIndex === 1 ? -40 : -20));
            rules.availability.below_min_penalty = belowBase * availWeight;
            rules.availability.log10_multiplier = 12 * availWeight;

            // –û–∑–≤—É—á–∫–∞: –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –≤–Ω–µ—Å–æ–∫ (–Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –¥–æ–≤–∂–∏–Ω–∏ –ø–µ—Ä–µ–ª—ñ–∫—É –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤)
            const audioTrackWeight = priorityWeights['audio_track'] / 100;
            rules.audio_track.max_points = 100 * audioTrackWeight;

            // –Ø–∫—ñ—Å—Ç—å –∑–≤—É–∫—É: –æ—á–∫–∏ –ª–∏—à–µ –∑–∞ —Ç–µ, —â–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π –ø—ñ–¥—Ç—Ä–∏–º—É—î (–±–µ–∑ —à—Ç—Ä–∞—Ñ—ñ–≤ –∑–∞ "–∑–∞–π–≤–µ")
            const aqWeight = priorityWeights['audio_quality'] / 100;
            const supports = new Set(audioSupport || []);
            // –°—Ç–µ—Ä–µ–æ —Å—á–∏—Ç–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–æ–º ‚Äî –Ω–µ –¥–∞—ë–º –∑–∞ –Ω–µ–≥–æ –±–æ–Ω—É—Å–Ω—ã—Ö –æ—á–∫–æ–≤
            const baseAQ = { dolby_atmos: 80, surround_71: 60, surround_51: 40, stereo: 0, unknown: 0 };
            rules.audio_quality.points = {
                dolby_atmos: (supports.has('dolby_atmos') ? baseAQ.dolby_atmos : 0) * aqWeight,
                surround_71: (supports.has('surround_71') ? baseAQ.surround_71 : 0) * aqWeight,
                surround_51: (supports.has('surround_51') ? baseAQ.surround_51 : 0) * aqWeight,
                stereo: 0,
                unknown: 0
            };

            // Special rules: –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω—É –ª–æ–≥—ñ–∫—É —ñ–∑ –ø–ª–∞–≥—ñ–Ω–∞ –≤ –∫–æ–Ω—Ñ—ñ–≥ (–≥–µ–Ω–µ—Ä—É—î–º —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –≤–æ–Ω–∞ —Ç—Ä–µ–±–∞)
            if (deviceType.includes('4k') && paramPriority[0] === 'resolution') {
                rules.special_rules = [
                    { key: "4k_bonus_2160_bitrate", if: { resolution: 2160, bitrate_min: 1 }, bonus: 80 },
                    { key: "4k_bonus_2160", if: { resolution: 2160 }, bonus: 30 },
                    { key: "4k_bonus_1080_seeds", if: { resolution: 1080, seeds_min: 51, bitrate_min: 1 }, bonus: 10 }
                ];
            }

            return rules;
        }

        function getRadioValue(name) {
            const radio = document.querySelector(`input[name="${name}"]:checked`);
            return radio ? radio.value : null;
        }

        function getCheckboxValues(name) {
            const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function displayConfig(config) {
            const output = document.getElementById('configOutput');
            output.textContent = JSON.stringify(config, null, 2);
        }

        function copyConfig() {
            const output = document.getElementById('configOutput');
            const textArea = document.createElement('textarea');
            textArea.value = output.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
            setTimeout(() => btn.textContent = originalText, 2000);
        }
    </script>
</body>
</html>

